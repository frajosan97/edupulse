import{S,r as u,j as e,q as N,a as E}from"./app-CiDaUcey.js";import{y as x,P as M}from"./PortalLayout-CxqdbcvG.js";import{C as _,D as F,e as P}from"./index-NpM1gPvR.js";import{x as v}from"./useData-CInDpAgI.js";import{S as j}from"./sweetalert2.esm.all-89IKscqO.js";import{u as A}from"./useErrorToast-CTAe8NjK.js";import{S as I}from"./react-select.esm-Le_u87zZ.js";import{M as h}from"./Modal-CviNt8xm.js";import{F as p}from"./Form-DY59OgGH.js";import{R as T}from"./Row-DoEZsrd7.js";import{C as m}from"./Col-H7LL1jeG.js";import{I as y}from"./InputGroup-B5mTNa8N.js";import{B as g}from"./warning-CDyBO85i.js";import{B as L}from"./ButtonGroup-Bf8VZ0Fe.js";import{m as O}from"./proxy-CjJB-Dek.js";import{C as k}from"./Card-O6qekqvm.js";import{T as q}from"./Table-CC8sxR3u.js";import"./CloseButton-uf0rwOsm.js";import"./ElementChildren-Ykn35dyp.js";const R=()=>{const t=Date.now().toString(36),d=Math.random().toString(36).slice(2,6);return`GS-${t}-${d}`.toUpperCase()},B=(t=null)=>({name:(t==null?void 0:t.name)??"",code:(t==null?void 0:t.code)??R(),description:(t==null?void 0:t.description)??"",type:(t==null?void 0:t.type)??"percentage",is_default:(t==null?void 0:t.is_default)??!1,is_active:(t==null?void 0:t.is_active)??!0});function U({show:t,onHide:d,editingGradingSystem:o=null}){const n=!!o,{showErrorToast:f}=A(),{data:s,setData:r,processing:b,reset:l}=S(B()),i=[{value:"percentage",label:"Percentage"},{value:"letter",label:"Letter"},{value:"gpa",label:"GPA"},{value:"custom",label:"Custom"}];u.useEffect(()=>{t&&r(B(n?o:null))},[t,n,o,r]);const c=async a=>{a.preventDefault();const C=n?"Update":"Create";try{if(!(await j.fire({title:`${C} Grading System`,text:`Confirm to ${C.toLowerCase()} this grading system.`,icon:"question",showCancelButton:!0,confirmButtonText:"Yes",cancelButtonText:"Cancel",reverseButtons:!0})).isConfirmed)return;j.fire({title:"Please wait...",text:`${C} in progress`,icon:"info",allowOutsideClick:!1,allowEscapeKey:!1,didOpen:()=>j.showLoading()});const G=n?route("admin.grading-system.update",o.id):route("admin.grading-system.store"),D=n?await v.put(G,s):await v.post(G,s);D.data.success&&(x.success(D.data.message||"Saved successfully"),l(),d())}catch(w){f(w)}finally{j.close()}};return e.jsx(h,{show:t,onHide:d,size:"lg",centered:!0,children:e.jsxs(p,{onSubmit:c,children:[e.jsx(h.Header,{closeButton:!0,children:e.jsx(h.Title,{children:n?"Edit Grading System":"Create Grading System"})}),e.jsxs(h.Body,{children:[e.jsxs(T,{className:"mb-3",children:[e.jsx(m,{md:4,children:e.jsxs(y,{children:[e.jsx(y.Text,{children:e.jsx(_,{})}),e.jsx(p.Control,{placeholder:"Grading System Name",value:s.name,onChange:a=>r("name",a.target.value),required:!0})]})}),e.jsx(m,{md:4,children:e.jsxs(y,{children:[e.jsx(y.Text,{children:e.jsx(F,{})}),e.jsx(p.Control,{placeholder:"Code",value:s.code,readOnly:!0,className:"bg-light"})]})}),e.jsx(m,{md:4,children:e.jsx(I,{options:i,value:i.find(a=>a.value===s.type),onChange:a=>r("type",(a==null?void 0:a.value)??"percentage"),placeholder:"Select Grading Type"})})]}),e.jsx(T,{className:"mb-3",children:e.jsx(m,{children:e.jsx(p.Control,{as:"textarea",rows:2,placeholder:"Description",value:s.description,onChange:a=>r("description",a.target.value)})})}),e.jsxs(T,{children:[e.jsx(m,{md:6,children:e.jsx(p.Check,{label:"Default Grading System",checked:s.is_default,onChange:a=>r("is_default",a.target.checked)})}),e.jsx(m,{md:6,children:e.jsx(p.Check,{label:"Active",checked:s.is_active,onChange:a=>r("is_active",a.target.checked)})})]})]}),e.jsxs(h.Footer,{children:[e.jsx(g,{variant:"secondary",onClick:d,children:"Cancel"}),e.jsx(g,{variant:"primary",type:"submit",disabled:b,children:b?"Saving...":n?"Update":"Create"})]})]})})}function ce(){const{auth:t}=N().props,[d,o]=u.useState(!1),[n,f]=u.useState(null),s=u.useCallback(()=>{$.fn.DataTable.isDataTable("#gradingSystemsTable")&&$("#gradingSystemsTable").DataTable().destroy(),$("#gradingSystemsTable").DataTable({processing:!0,serverSide:!0,ajax:{url:route("admin.grading-system.index"),type:"GET"},columns:[{data:"code",title:"Code"},{data:"name",title:"Name"},{data:"type",title:"Type"},{data:"is_default",title:"Default",render:l=>l?"✔️":"❌"},{data:"status",title:"Active"},{data:"action",title:"Actions",className:"text-end"}],order:[[1,"asc"]],responsive:!0,autoWidth:!1})},[]),r=u.useCallback(async l=>{var i,c;try{if(!(await j.fire({title:"Delete Grading System?",text:"This will remove the grading system permanently.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel",reverseButtons:!0})).isConfirmed)return;(await v.delete(route("admin.grading-system.destroy",l))).status===200&&($("#gradingSystemsTable").DataTable().ajax.reload(null,!1),x.success("Grading System deleted successfully!"))}catch(a){x.error(((c=(i=a==null?void 0:a.response)==null?void 0:i.data)==null?void 0:c.message)||"An error occurred. Please try again.")}},[]);u.useEffect(()=>{s();const l=c=>{const a=$(c.currentTarget).data("data");if(!a)return x.error("Grading System data not found.");f(a),o(!0)},i=c=>{const a=$(c.currentTarget).data("id");if(!a)return x.error("Grading System ID not found.");r(a)};return $(document).on("click",".edit-btn",l),$(document).on("click",".delete-btn",i),()=>{$.fn.DataTable.isDataTable("#gradingSystemsTable")&&$("#gradingSystemsTable").DataTable().destroy(),$(document).off("click",".edit-btn",l),$(document).off("click",".delete-btn",i)}},[s,r]);const b=u.useCallback(()=>{o(!1),f(null),$("#gradingSystemsTable").DataTable().ajax.reload(null,!1)},[]);return e.jsxs(M,{user:t.user,children:[e.jsx(E,{title:"Grading System Management"}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h1",{className:"h3 mb-0",children:"Grading System Management"}),e.jsx(L,{children:e.jsxs(g,{variant:"outline-primary",onClick:()=>{f(null),o(!0)},className:"rounded",children:[e.jsx(P,{className:"me-1"})," New Grading System"]})})]}),e.jsx("hr",{className:"dashed-hr"}),e.jsx(T,{children:e.jsx(m,{children:e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:e.jsx(k,{children:e.jsx(k.Body,{children:e.jsx(q,{id:"gradingSystemsTable",className:"w-100 table-striped table-bordered",responsive:!0})})})})})}),e.jsx(U,{show:d,onHide:b,editingGradingSystem:n})]})}export{ce as default};
