import{r as p,R as x,j as e,a as N,f as _}from"./app-CiDaUcey.js";import{P as B,y as w}from"./PortalLayout-CxqdbcvG.js";import{x as T}from"./useData-CInDpAgI.js";import{S as j}from"./sweetalert2.esm.all-89IKscqO.js";import{R as b}from"./Row-DoEZsrd7.js";import{C as g}from"./Col-H7LL1jeG.js";import{P as c,B as O}from"./warning-CDyBO85i.js";import{B as P}from"./ButtonGroup-Bf8VZ0Fe.js";import{A as z}from"./Alert-BvxkaIon.js";import{C as d}from"./Card-O6qekqvm.js";import{B as E}from"./Badge-B8SxXTMH.js";import"./CloseButton-uf0rwOsm.js";var M=["color","size","title","className"];function f(){return f=Object.assign?Object.assign.bind():function(s){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)({}).hasOwnProperty.call(t,r)&&(s[r]=t[r])}return s},f.apply(null,arguments)}function D(s,n){if(s==null)return{};var t,r,l=R(s,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(s);for(r=0;r<i.length;r++)t=i[r],n.includes(t)||{}.propertyIsEnumerable.call(s,t)&&(l[t]=s[t])}return l}function R(s,n){if(s==null)return{};var t={};for(var r in s)if({}.hasOwnProperty.call(s,r)){if(n.includes(r))continue;t[r]=s[r]}return t}var C=p.forwardRef(function(s,n){var t=s.color,r=t===void 0?"currentColor":t,l=s.size,i=l===void 0?"1em":l,m=s.title,a=m===void 0?null:m,o=s.className,u=o===void 0?"":o,h=D(s,M);return x.createElement("svg",f({ref:n,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",width:i,height:i,fill:r,className:["bi","bi-database",u].filter(Boolean).join(" ")},h),a?x.createElement("title",null,a):null,x.createElement("path",{d:"M4.318 2.687C5.234 2.271 6.536 2 8 2s2.766.27 3.682.687C12.644 3.125 13 3.627 13 4c0 .374-.356.875-1.318 1.313C10.766 5.729 9.464 6 8 6s-2.766-.27-3.682-.687C3.356 4.875 3 4.373 3 4c0-.374.356-.875 1.318-1.313M13 5.698V7c0 .374-.356.875-1.318 1.313C10.766 8.729 9.464 9 8 9s-2.766-.27-3.682-.687C3.356 7.875 3 7.373 3 7V5.698c.271.202.58.378.904.525C4.978 6.711 6.427 7 8 7s3.022-.289 4.096-.777A5 5 0 0 0 13 5.698M14 4c0-1.007-.875-1.755-1.904-2.223C11.022 1.289 9.573 1 8 1s-3.022.289-4.096.777C2.875 2.245 2 2.993 2 4v9c0 1.007.875 1.755 1.904 2.223C4.978 15.71 6.427 16 8 16s3.022-.289 4.096-.777C13.125 14.755 14 14.007 14 13zm-1 4.698V10c0 .374-.356.875-1.318 1.313C10.766 11.729 9.464 12 8 12s-2.766-.27-3.682-.687C3.356 10.875 3 10.373 3 10V8.698c.271.202.58.378.904.525C4.978 9.71 6.427 10 8 10s3.022-.289 4.096-.777A5 5 0 0 0 13 8.698m0 3V13c0 .374-.356.875-1.318 1.313C10.766 14.729 9.464 15 8 15s-2.766-.27-3.682-.687C3.356 13.875 3 13.373 3 13v-1.302c.271.202.58.378.904.525C4.978 12.71 6.427 13 8 13s3.022-.289 4.096-.777c.324-.147.633-.323.904-.525"}))});C.propTypes={color:c.string,size:c.oneOfType([c.string,c.number]),title:c.string,className:c.string};var H=["color","size","title","className"];function v(){return v=Object.assign?Object.assign.bind():function(s){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)({}).hasOwnProperty.call(t,r)&&(s[r]=t[r])}return s},v.apply(null,arguments)}function V(s,n){if(s==null)return{};var t,r,l=A(s,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(s);for(r=0;r<i.length;r++)t=i[r],n.includes(t)||{}.propertyIsEnumerable.call(s,t)&&(l[t]=s[t])}return l}function A(s,n){if(s==null)return{};var t={};for(var r in s)if({}.hasOwnProperty.call(s,r)){if(n.includes(r))continue;t[r]=s[r]}return t}var y=p.forwardRef(function(s,n){var t=s.color,r=t===void 0?"currentColor":t,l=s.size,i=l===void 0?"1em":l,m=s.title,a=m===void 0?null:m,o=s.className,u=o===void 0?"":o,h=V(s,H);return x.createElement("svg",v({ref:n,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",width:i,height:i,fill:r,className:["bi","bi-table",u].filter(Boolean).join(" ")},h),a?x.createElement("title",null,a):null,x.createElement("path",{d:"M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm15 2h-4v3h4zm0 4h-4v3h4zm0 4h-4v3h3a1 1 0 0 0 1-1zm-5 3v-3H6v3zm-5 0v-3H1v2a1 1 0 0 0 1 1zm-4-4h4V8H1zm0-4h4V4H1zm5-3v3h4V4zm4 4H6v3h4z"}))});y.propTypes={color:c.string,size:c.oneOfType([c.string,c.number]),title:c.string,className:c.string};function Z({database:s,dbInfo:n,tables:t=[],totalSize:r,error:l=null}){const i=p.useCallback(()=>{$.fn.DataTable.isDataTable("#tablesTable")&&$("#tablesTable").DataTable().destroy(),$("#tablesTable").DataTable({responsive:!0,pageLength:10,lengthMenu:[5,10,25,50,100],order:[[1,"asc"]]})},[]);p.useEffect(()=>{!l&&t.length>0&&i()},[t,l,i]);const m=async()=>{var o,u;if((await j.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes,  migrate!",cancelButtonText:"Cancel"})).isConfirmed){j.fire({title:"Migrating",text:"Please wait",allowOutsideClick:!1,showConfirmButton:!1,didOpen:()=>j.showLoading()});try{const h=await T.put(route("admin.database.update",s.id));h.data.success===!0&&(j.close(),w.success(h.data.message),_.reload())}catch(h){j.close(),w.error(((u=(o=h.response)==null?void 0:o.data)==null?void 0:u.message)||"An error occurred")}}};return e.jsxs(B,{children:[e.jsx(N,{title:`${s==null?void 0:s.database} Database`}),e.jsx(b,{children:e.jsxs(g,{md:12,className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("h2",{className:"m-0 text-capitalize",children:[e.jsx(C,{className:"me-2"}),s==null?void 0:s.database," Database"]}),e.jsx(P,{children:e.jsx(O,{variant:"primary",onClick:()=>m(),children:"Re-run Migration"})})]})}),e.jsx("hr",{className:"dashed-hr"}),l&&e.jsxs(z,{variant:"danger",children:[e.jsx("strong",{children:"Error:"})," ",l]}),!l&&e.jsxs(e.Fragment,{children:[e.jsxs(b,{className:"mb-4",children:[e.jsx(g,{md:6,children:e.jsxs(d,{className:"shadow-sm",children:[e.jsx(d.Header,{className:"bg-transparent fw-bold",children:"Database Info"}),e.jsxs(d.Body,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",n==null?void 0:n.database_name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Character Set:"})," ",n==null?void 0:n.character_set]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Collation:"})," ",n==null?void 0:n.collation]}),e.jsxs("p",{children:[e.jsx("strong",{children:"SQL Path:"})," ",(n==null?void 0:n.sql_path)||"N/A"]})]})]})}),e.jsx(g,{md:6,children:e.jsxs(d,{className:"shadow-sm",children:[e.jsx(d.Header,{className:"bg-transparent fw-bold",children:"Size Summary"}),e.jsxs(d.Body,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Total Size:"})," ",r==null?void 0:r.total_size_mb," MB"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Data Size:"})," ",r==null?void 0:r.data_size_mb," MB"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Index Size:"})," ",r==null?void 0:r.index_size_mb," MB"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Table Count:"})," ",r==null?void 0:r.table_count]})]})]})})]}),e.jsxs(d,{className:"shadow-sm",children:[e.jsxs(d.Header,{className:"bg-transparent fw-bold d-flex align-items-center",children:[e.jsx(y,{className:"me-2"}),"Tables (",t.length,")"]}),e.jsx(d.Body,{children:e.jsxs("table",{id:"tablesTable",className:"table table-striped table-bordered table-hover w-100 mb-0",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Table Name"}),e.jsx("th",{children:"Rows"}),e.jsx("th",{children:"Exact Rows"}),e.jsx("th",{children:"Engine"}),e.jsx("th",{children:"Collation"}),e.jsx("th",{children:"Created"}),e.jsx("th",{children:"Updated"}),e.jsx("th",{children:"Data Size"}),e.jsx("th",{children:"Index Size"}),e.jsx("th",{children:"Total Size"})]})}),e.jsx("tbody",{children:t.length>0?t.map((a,o)=>e.jsxs("tr",{children:[e.jsx("td",{children:o+1}),e.jsx("td",{children:a.table_name}),e.jsx("td",{children:a.row_count}),e.jsx("td",{children:a.exact_row_count}),e.jsx("td",{children:e.jsx(E,{bg:"secondary",children:a.engine})}),e.jsx("td",{children:a.collation}),e.jsx("td",{children:a.created_at||"—"}),e.jsx("td",{children:a.updated_at||"—"}),e.jsxs("td",{children:[a.data_size_mb," MB"]}),e.jsxs("td",{children:[a.index_size_mb," MB"]}),e.jsxs("td",{children:[a.total_size_mb," MB"]})]},a.table_name)):e.jsx("tr",{children:e.jsx("td",{colSpan:"11",className:"text-center",children:"No tables found."})})})]})})]})]})]})}export{Z as default};
