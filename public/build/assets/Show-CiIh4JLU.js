import{r as f,j as e,f as B,a as L}from"./app-CiDaUcey.js";import{b as P}from"./helpers-CqFYgsdY.js";import{y as D,P as E}from"./PortalLayout-CxqdbcvG.js";import{S as b}from"./sweetalert2.esm.all-89IKscqO.js";import{x as k}from"./useData-CInDpAgI.js";import{u as I}from"./useErrorToast-CTAe8NjK.js";import{M as v}from"./Modal-CviNt8xm.js";import{F as d}from"./Form-DY59OgGH.js";import{R as S}from"./Row-DoEZsrd7.js";import{C as j}from"./Col-H7LL1jeG.js";import{B as g}from"./warning-CDyBO85i.js";import{T as F}from"./Table-CC8sxR3u.js";import{B as M}from"./ButtonGroup-Bf8VZ0Fe.js";import{B as K}from"./Badge-B8SxXTMH.js";import{C as A}from"./Card-O6qekqvm.js";import{T as z}from"./Tabs-DQd2b_FZ.js";import{T as _}from"./Tab-BBitmCVB.js";import"./CloseButton-uf0rwOsm.js";import"./ElementChildren-Ykn35dyp.js";function O({show:t,handleClose:c,isEditing:l=!1,currentStreamId:r=null,teachers:n=[],streams:o=[],classId:x}){const{showErrorToast:y}=I(),[u,T]=f.useState({class_id:x,stream_id:"",class_teacher_id:"",assistant_teacher_id:"",is_active:!0});f.useEffect(()=>{!l||!r||(b.fire({title:"Loading...",text:"Fetching class stream details",icon:"info",allowOutsideClick:!1,allowEscapeKey:!1,didOpen:()=>b.showLoading()}),k.get(route("admin.class-stream.edit",r)).then(a=>{T(a.data.data)}).catch(()=>{D.error("Failed to load stream data")}).finally(()=>b.close()))},[l,r]);const p=a=>{const{name:s,value:i,type:m,checked:h}=a.target;T(N=>({...N,[s]:m==="checkbox"?h:i}))},C=async a=>{var i;a.preventDefault();const s=l?"Update":"Add";try{if(!(await b.fire({title:`${s} Class Stream`,text:`Confirm to ${s.toLowerCase()} this class stream.`,icon:"question",showCancelButton:!0,confirmButtonText:"Yes",cancelButtonText:"Cancel",reverseButtons:!0})).isConfirmed)return;b.fire({title:"Please wait...",text:`${s} in progress`,icon:"info",allowOutsideClick:!1,allowEscapeKey:!1,didOpen:()=>b.showLoading()});const h=l?route("admin.class-stream.update",r):route("admin.class-stream.store"),w=await k[l?"put":"post"](h,u);(i=w.data)!=null&&i.success&&(D.success(w.data.message),c())}catch(m){y(m)}finally{b.close()}};return e.jsx(v,{show:t,onHide:c,size:"lg",centered:!0,children:e.jsxs(d,{onSubmit:C,children:[e.jsx(v.Header,{closeButton:!0,children:e.jsx(v.Title,{children:l?"Edit Class Stream":"Add Stream to Class"})}),e.jsxs(v.Body,{children:[e.jsx(S,{children:e.jsx(j,{children:e.jsxs(d.Group,{className:"mb-3",children:[e.jsxs(d.Label,{children:["Stream"," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs(d.Select,{name:"stream_id",value:u.stream_id,onChange:p,required:!0,disabled:l,children:[e.jsx("option",{value:"",children:"Select a Stream"}),o.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]})})}),e.jsxs(S,{children:[e.jsx(j,{md:6,children:e.jsxs(d.Group,{className:"mb-3",children:[e.jsxs(d.Label,{children:["Manager"," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs(d.Select,{name:"class_teacher_id",value:u.class_teacher_id,onChange:p,required:!0,children:[e.jsx("option",{value:"",children:"Select Manager"}),n.map(a=>e.jsx("option",{value:a.id,children:a.full_name},a.id))]})]})}),e.jsx(j,{md:6,children:e.jsxs(d.Group,{className:"mb-3",children:[e.jsx(d.Label,{children:"Assistant Manager"}),e.jsxs(d.Select,{name:"assistant_teacher_id",value:u.assistant_teacher_id,onChange:p,children:[e.jsx("option",{value:"",children:"Select Assistant Manager"}),n.map(a=>e.jsx("option",{value:a.id,children:a.full_name},a.id))]})]})})]}),e.jsx(d.Check,{type:"switch",id:"is_active",name:"is_active",label:"Active Stream",checked:u.is_active,onChange:p,className:"mt-2"})]}),e.jsxs(v.Footer,{children:[e.jsx(g,{variant:"secondary",onClick:c,children:"Cancel"}),e.jsx(g,{variant:"primary",type:"submit",children:l?"Update Stream":"Add Stream"})]})]})})}const q=({classData:t,streams:c,teachers:l})=>{var a;const[r,n]=f.useState(!1),[o,x]=f.useState(!1),[y,u]=f.useState(null);f.useEffect(()=>{const i=setTimeout(()=>{$.fn.DataTable.isDataTable("#streamsTable")&&$("#streamsTable").DataTable().destroy(),$("#streamsTable").DataTable({responsive:!0,pageLength:10,lengthMenu:[5,10,25,50],order:[[0,"asc"]],language:{search:"_INPUT_",searchPlaceholder:"Search streams..."}})},100);return()=>{clearTimeout(i),$.fn.DataTable.isDataTable("#streamsTable")&&$("#streamsTable").DataTable().destroy()}},[t]);const T=(s=!1,i=null)=>{x(s),u((i==null?void 0:i.id)||null),n(!0)},p=()=>{n(!1),x(!1),u(null),B.reload()},C=s=>{Swal.fire({title:"Are you sure?",text:"This will remove the stream from this class!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"}).then(i=>{i.isConfirmed&&xios.delete(route("classstreams.destroy",s)).then(()=>{toast.success("Stream removed successfully!"),B.reload()}).catch(m=>{var h,N;toast.error(((N=(h=m.response)==null?void 0:h.data)==null?void 0:N.message)||"Failed to remove stream")})})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h5",{className:"mb-0",children:["Streams in ",t.name]}),e.jsxs(g,{variant:"primary",size:"sm",onClick:()=>T(!1),children:[e.jsx("i",{className:"bi bi-plus-circle me-1"}),"Add Stream"]})]}),e.jsx("hr",{className:"dashed-hr"}),e.jsxs(F,{id:"streamsTable",responsive:!0,bordered:!0,hover:!0,className:"data-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Stream Name"}),e.jsx("th",{children:"Class Teachers"}),e.jsx("th",{children:"Students"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:(a=t.class_streams)==null?void 0:a.map((s,i)=>{var m,h;return e.jsxs("tr",{children:[e.jsx("td",{children:i+1}),e.jsx("td",{children:(m=s==null?void 0:s.stream)==null?void 0:m.name}),e.jsxs("td",{children:[(s==null?void 0:s.class_teacher)&&e.jsx("h6",{className:"mb-0",children:s.class_teacher.full_name}),(s==null?void 0:s.assistant_teacher)&&e.jsx("p",{className:"text-muted small mb-0",children:s.assistant_teacher.full_name})]}),e.jsx("td",{children:((h=s==null?void 0:s.students)==null?void 0:h.length)||0}),e.jsx("td",{children:e.jsxs(M,{className:"gap-2",children:[e.jsxs(g,{variant:"outline-primary",size:"sm",onClick:()=>T(!0,s),children:[e.jsx("i",{className:"bi bi-pencil-square me-1"}),"Edit"]}),e.jsxs(g,{variant:"outline-danger",size:"sm",onClick:()=>C(s.id),children:[e.jsx("i",{className:"bi bi-trash me-1"}),"Delete"]})]})})]},s.id)})})]}),e.jsx(O,{show:r,handleClose:p,isEditing:o,currentStreamId:y,teachers:l,streams:c,classId:t.id})]})},G=({classData:t})=>{var c,l;return f.useEffect(()=>{const n=setTimeout(()=>{$.fn.DataTable.isDataTable("#studentsTable")&&$("#studentsTable").DataTable().destroy(),$("#studentsTable").DataTable({responsive:!0,pageLength:10,lengthMenu:[5,10,25,50],order:[[0,"asc"]],language:{search:"_INPUT_",searchPlaceholder:"Search students..."}})},100);return()=>{clearTimeout(n),$(".data-table").DataTable().destroy()}},[t]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h5",{children:["Students in ",t.name]}),e.jsxs(K,{bg:"primary",children:[((c=t.students)==null?void 0:c.length)||0," Students"]})]}),e.jsx("hr",{className:"dashed-hr"}),e.jsxs(F,{id:"studentsTable",responsive:!0,bordered:!0,hover:!0,className:"data-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Adm"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:(l=t.students)==null?void 0:l.map((r,n)=>{var o;return e.jsxs("tr",{children:[e.jsx("td",{children:n+1}),e.jsx("td",{children:(o=r.student)==null?void 0:o.adm}),e.jsx("td",{children:r.name}),e.jsx("td",{})]},r.id)})})]})]})};function ce({classData:t,streams:c=[],teachers:l=[]}){const{name:r,is_active:n,class_teacher:o,assistant_teacher:x}=t;return e.jsxs(E,{children:[e.jsx(L,{title:`Class ${r} Details`}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("h1",{className:"h3 text-capitalize mb-0",children:[e.jsx("i",{className:"bi bi-mortarboard-fill me-2"}),r," Management"]}),e.jsx(M,{children:e.jsxs(g,{variant:"outline-primary",className:"rounded",onClick:()=>window.history.back(),children:[e.jsx("i",{className:"bi bi-arrow-left me-1"}),"Back"]})})]}),e.jsx("hr",{className:"dashed-hr"}),e.jsx(S,{children:e.jsx(j,{children:e.jsx(A,{children:e.jsx(A.Body,{children:e.jsxs(z,{defaultActiveKey:"classInfo",transition:!1,id:"class-details-tabs",className:"mb-3 p-1 pb-0",children:[e.jsx(_,{eventKey:"classInfo",title:e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"Class Information"]}),children:e.jsxs(S,{className:"g-3 mt-2",children:[e.jsx(j,{md:6,children:e.jsxs("div",{className:"border rounded p-3 bg-light",children:[e.jsx("p",{className:"text-muted small mb-1",children:"Class Name"}),e.jsxs("h5",{children:[e.jsx("i",{className:"bi bi-building me-2"}),r]})]})}),e.jsx(j,{md:6,children:e.jsxs("div",{className:"border rounded p-3 bg-light",children:[e.jsx("p",{className:"text-muted small mb-1",children:"Status"}),P(n)]})}),e.jsx(j,{md:6,children:e.jsxs("div",{className:"border rounded p-3 bg-light",children:[e.jsxs("p",{className:"text-muted small mb-1",children:[e.jsx("i",{className:"bi bi-person-badge me-1"}),"Class Teacher"]}),e.jsx("h5",{children:(o==null?void 0:o.full_name)||"Not assigned"})]})}),e.jsx(j,{md:6,children:e.jsxs("div",{className:"border rounded p-3 bg-light",children:[e.jsxs("p",{className:"text-muted small mb-1",children:[e.jsx("i",{className:"bi bi-person me-1"}),"Assistant Teacher"]}),e.jsx("h5",{children:(x==null?void 0:x.full_name)||"Not assigned"})]})})]})}),e.jsx(_,{eventKey:"streams",title:e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-diagram-3 me-1"}),"Streams"]}),children:e.jsx(q,{classData:t,streams:c,teachers:l})}),e.jsx(_,{eventKey:"students",title:e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-people-fill me-1"}),"Students"]}),children:e.jsx(G,{classData:t})})]})})})})})]})}export{ce as default};
