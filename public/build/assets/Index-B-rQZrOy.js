import{S as O,r as o,j as e,f as _,q as P,a as z}from"./app-bV1oKjKy.js";import{o as U,p as D,q as Y,r as H,s as R,e as K}from"./index-6KH3gXbP.js";import{y as S,B as W,a as J,P as Q}from"./PortalLayout-u-5QNYDI.js";import{S as x}from"./sweetalert2.esm.all-89IKscqO.js";import{x as N}from"./useData-Bpd0XriX.js";import{S as F}from"./react-select.esm-BkhK0xLv.js";import{u as M}from"./useErrorToast-B9XNEQ0p.js";import{M as h}from"./Modal-Cs-ZlOYu.js";import{F as c}from"./Form-CnKhehiI.js";import{R as E}from"./Row-B4t5VXUr.js";import{C as k}from"./Col-CcX1xzGs.js";import{I as B}from"./InputGroup-C1XhqFRU.js";import{B as T}from"./warning-DViRBwvh.js";import{b as V}from"./helpers-DALsaz0e.js";import{T as q}from"./Table-M2KRe3ue.js";import{B as G}from"./ButtonGroup-eq7KuXkt.js";import{m as X}from"./proxy-DX8jdYJD.js";import{C as A}from"./Card-ClEnLKUp.js";import"./CloseButton-BYbBlkTD.js";import"./ElementChildren-C0T05OxF.js";import"./Badge-DAm-MJP0.js";function Z({show:t,onHide:j,teachers:f=[],editingClass:r=null}){const d=!!r,{showErrorToast:p}=M(),{data:u,setData:m,processing:v,reset:C,errors:b}=O({name:"",class_teacher_id:"",assistant_teacher_id:"",is_active:!0}),y=o.useMemo(()=>f.map(s=>({value:s.id,label:s.full_name})),[f]);o.useEffect(()=>{d?m({name:r.name??"",class_teacher_id:r.class_teacher_id??"",assistant_teacher_id:r.assistant_teacher_id??"",is_active:r.is_active??!0}):C()},[r,d]);const a=s=>y.find(n=>n.value===s)||null,l=async s=>{var i;s.preventDefault();const n=d?"Update":"Create";try{if(!(await x.fire({title:`${n} Class`,text:`Confirm to ${n.toLowerCase()} this class.`,icon:"question",showCancelButton:!0,confirmButtonText:"Yes",cancelButtonText:"Cancel",reverseButtons:!0})).isConfirmed)return;x.fire({title:"Please wait...",text:`${n} in progress`,icon:"info",allowOutsideClick:!1,allowEscapeKey:!1,didOpen:()=>x.showLoading()});const w=d?route("admin.class.update",r.id):route("admin.class.store"),L=d?await N.put(w,u):await N.post(w,u);(i=L.data)!=null&&i.success&&(S.success(L.data.message||`Class ${n.toLowerCase()}d successfully`),C(),j())}catch(g){p(g)}finally{x.close()}};return e.jsx(h,{show:t,onHide:j,size:"lg",centered:!0,children:e.jsxs(c,{onSubmit:l,children:[e.jsx(h.Header,{closeButton:!0,children:e.jsx(h.Title,{children:d?"Edit Class":"Create New Class"})}),e.jsxs(h.Body,{children:[e.jsx(E,{children:e.jsx(k,{children:e.jsxs(c.Group,{className:"mb-3",children:[e.jsxs(c.Label,{children:["Class Name"," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs(B,{children:[e.jsx(B.Text,{children:e.jsx(U,{})}),e.jsx(c.Control,{type:"text",value:u.name,onChange:s=>m("name",s.target.value),isInvalid:!!b.name,required:!0}),e.jsx(c.Control.Feedback,{type:"invalid",children:b.name})]})]})})}),e.jsxs(E,{children:[e.jsx(k,{md:6,children:e.jsxs(c.Group,{className:"mb-3",children:[e.jsxs(c.Label,{children:["Class Teacher"," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(F,{options:y,value:a(u.class_teacher_id),onChange:s=>m("class_teacher_id",(s==null?void 0:s.value)||""),placeholder:"Select Teacher"})]})}),e.jsx(k,{md:6,children:e.jsxs(c.Group,{className:"mb-3",children:[e.jsx(c.Label,{children:"Assistant Teacher"}),e.jsx(F,{options:y,value:a(u.assistant_teacher_id),onChange:s=>m("assistant_teacher_id",(s==null?void 0:s.value)||""),placeholder:"Select Assistant (Optional)",isClearable:!0})]})})]}),e.jsx(c.Check,{type:"switch",id:"class-active",label:"Active",checked:u.is_active,onChange:s=>m("is_active",s.target.checked),className:"mt-3"})]}),e.jsxs(h.Footer,{children:[e.jsx(T,{variant:"secondary",onClick:j,disabled:v,children:"Cancel"}),e.jsx(T,{type:"submit",variant:"primary",disabled:v,children:v?`${d?"Updating":"Creating"}...`:d?"Update Class":"Create Class"})]})]})})}const I=(t=null)=>({name:(t==null?void 0:t.name)??"",active:(t==null?void 0:t.active)??!0});function ee({stream:t=null,show:j,handleClose:f}){const r=!!t,{showErrorToast:d}=M(),{data:p,setData:u,processing:m,reset:v,errors:C}=O(I(t));o.useEffect(()=>{j&&u(I(r?t:null))},[j,r,t,u]);const b=({target:a})=>{const{name:l,value:s,type:n,checked:i}=a;u(l,n==="checkbox"?i:s)},y=async a=>{var s,n;a.preventDefault();const l=r?"Update":"Create";try{if(!(await x.fire({title:`${l} Stream`,text:`Confirm to ${l.toLowerCase()} this stream.`,icon:"question",showCancelButton:!0,confirmButtonText:"Yes",cancelButtonText:"Cancel",reverseButtons:!0})).isConfirmed)return;x.fire({title:"Please wait...",text:`${l} in progress`,icon:"info",allowOutsideClick:!1,allowEscapeKey:!1,didOpen:()=>x.showLoading()});const g=r?route("admin.stream.update",t.id):route("admin.stream.store"),w=r?await N.put(g,p):await N.post(g,p);((s=w==null?void 0:w.data)==null?void 0:s.success)!==!1&&(S.success(((n=w==null?void 0:w.data)==null?void 0:n.message)||`Stream ${l.toLowerCase()}d successfully!`),v(),f())}catch(i){d(i)}finally{x.close()}};return e.jsx(h,{show:j,onHide:f,size:"md",centered:!0,children:e.jsxs(c,{onSubmit:y,children:[e.jsx(h.Header,{closeButton:!0,children:e.jsxs(h.Title,{children:[e.jsx(D,{className:"me-2"}),r?"Update Stream":"Create Stream"]})}),e.jsxs(h.Body,{children:[e.jsxs(c.Group,{className:"mb-3",children:[e.jsx(c.Label,{children:"Stream Name"}),e.jsxs(B,{children:[e.jsx(B.Text,{children:e.jsx(D,{})}),e.jsx(c.Control,{type:"text",placeholder:"Enter stream name",value:p.name,onChange:b,isInvalid:!!C.name,name:"name",required:!0}),e.jsx(c.Control.Feedback,{type:"invalid",children:C.name})]})]}),e.jsx(c.Group,{className:"mb-3",children:e.jsx(c.Check,{type:"switch",id:"active",label:"Active",checked:p.active,onChange:b,name:"active"})})]}),e.jsxs(h.Footer,{children:[e.jsx(T,{variant:"outline-secondary",onClick:f,disabled:m,children:"Cancel"}),e.jsxs(T,{type:"submit",variant:"primary",disabled:m,children:[e.jsx(Y,{className:"me-2"}),r?"Update Stream":"Create Stream"]})]})]})})}function se({show:t,onHide:j,streams:f=[]}){const[r,d]=o.useState(!1),[p,u]=o.useState(null),{showErrorToast:m}=M(),v=o.useCallback(()=>{u(null),d(!0)},[]),C=o.useCallback(a=>{u(a),d(!0)},[]),b=o.useCallback(async a=>{try{if(!(await x.fire({title:"Delete stream?",text:"Are you sure you want to delete this stream?",icon:"question",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel",reverseButtons:!0})).isConfirmed)return;x.fire({title:"Deleting...",text:"Please wait",icon:"info",allowOutsideClick:!1,showConfirmButton:!1,didOpen:()=>x.showLoading()}),(await N.delete(route("admin.stream.destroy",a))).status===200&&(S.success("Stream deleted successfully!"),_.reload({only:["streams"]}))}catch(l){m(l)}finally{x.close()}},[m]),y=o.useCallback(()=>{d(!1),_.reload({only:["streams"]})},[]);return o.useEffect(()=>{if(!t)return;const a="#streamsTable";$.fn.DataTable.isDataTable(a)&&$(a).DataTable().destroy(),$(a).DataTable({responsive:!0,pageLength:5,lengthMenu:[5,10,25,50],order:[[0,"asc"]],autoWidth:!1,columnDefs:[{orderable:!1,targets:[2,3]},{width:"20%",targets:3}]})},[t,f]),e.jsxs(e.Fragment,{children:[e.jsxs(h,{show:t,onHide:j,size:"lg",centered:!0,children:[e.jsx(h.Header,{closeButton:!0,children:e.jsxs(h.Title,{children:[e.jsx(D,{className:"me-1"})," Streams List"]})}),e.jsxs(h.Body,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsxs("h5",{className:"m-0",children:["Total Streams: ",f.length]}),e.jsxs(T,{variant:"outline-primary",size:"sm",className:"rounded text-nowrap",onClick:v,children:[e.jsx(H,{className:"me-1"})," New Stream"]})]}),e.jsx("hr",{className:"dashed-hr"}),e.jsxs(q,{striped:!0,bordered:!0,hover:!0,responsive:!0,id:"streamsTable",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Stream Name"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Action"})]})}),e.jsx("tbody",{children:f.map((a,l)=>e.jsxs("tr",{children:[e.jsx("td",{children:l+1}),e.jsx("td",{children:a.name}),e.jsx("td",{children:V(a.is_active)}),e.jsx("td",{children:e.jsxs(G,{className:"gap-2",children:[e.jsxs(T,{variant:"outline-primary",size:"sm",onClick:()=>C(a),children:[e.jsx(W,{className:"me-1"})," ","Edit"]}),e.jsxs(T,{variant:"outline-danger",size:"sm",onClick:()=>b(a.id),children:[e.jsx(J,{className:"me-1"})," ","Delete"]})]})})]},a.id))})]})]})]}),e.jsx(ee,{stream:p,show:r,handleClose:y})]})}function Te({streams:t=[],teachers:j=[]}){const{auth:f,accessMode:r}=P().props,[d,p]=o.useState(!1),[u,m]=o.useState(!1),[v,C]=o.useState(null),b=o.useCallback(()=>{$.fn.DataTable.isDataTable("#classTable")&&$("#classTable").DataTable().destroy(),$("#classTable").DataTable({processing:!0,serverSide:!0,ajax:{url:route("admin.class.index"),type:"GET"},columns:[{data:"name",title:"Class/Form",className:"text-start"},{data:"class_streams_count",title:"Streams"},{data:"students_count",title:"Students"},{data:"class_teacher.full_name",title:"Manager"},{data:"assistant_teacher.full_name",title:"Assistant"},{data:"status",title:"Status"},{data:"action",title:"Actions",className:"text-end"}],order:[[0,"asc"]],responsive:!0,autoWidth:!1})},[]),y=o.useCallback(async l=>{var s,n;try{if(!(await x.fire({title:"Delete Class?",text:"Are you sure you want to delete this class?",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel",reverseButtons:!0})).isConfirmed)return;(await N.delete(route("admin.class.destroy",l))).status===200&&($("#classTable").DataTable().ajax.reload(null,!1),S.success("Class deleted successfully!"))}catch(i){S.error(((n=(s=i==null?void 0:i.response)==null?void 0:s.data)==null?void 0:n.message)||"An error occurred. Please try again.")}},[]);o.useEffect(()=>{b();const l=n=>{const i=$(n.currentTarget).data("data");if(!i)return S.error("Class data not found.");C(i),m(!0)},s=n=>{const i=$(n.currentTarget).data("id");if(!i)return S.error("Class ID not found.");y(i)};return $(document).on("click",".edit-btn",l),$(document).on("click",".delete-btn",s),()=>{$.fn.DataTable.isDataTable("#classTable")&&$("#classTable").DataTable().destroy(),$(document).off("click",".edit-btn",l),$(document).off("click",".delete-btn",s)}},[b,y]);const a=o.useCallback(()=>{p(!1),m(!1),C(null),_.reload()},[]);return e.jsxs(Q,{user:f.user,children:[e.jsx(z,{title:"Classes Management"}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h1",{className:"h3 mb-0",children:"Classes Management"}),r==="admin"&&e.jsxs(G,{children:[e.jsxs(T,{variant:"outline-primary",onClick:()=>p(!0),className:"rounded me-2",children:[e.jsx(R,{className:"me-1"})," Streams"]}),e.jsxs(T,{variant:"outline-primary",onClick:()=>{C(null),m(!0)},className:"rounded",children:[e.jsx(K,{className:"me-1"})," New Class"]})]})]}),e.jsx("hr",{className:"dashed-hr"}),e.jsx(E,{children:e.jsx(k,{children:e.jsx(X.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:e.jsx(A,{children:e.jsx(A.Body,{children:e.jsx(q,{id:"classTable",className:"w-100 table-striped table-bordered",responsive:!0})})})})})}),e.jsx(se,{streams:t,show:d,onHide:a}),e.jsx(Z,{show:u,onHide:a,teachers:j,editingClass:v})]})}export{Te as default};
