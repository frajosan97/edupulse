import{S as P,r as d,j as e,q as L,a as R}from"./app-bV1oKjKy.js";import{e as U}from"./index-6KH3gXbP.js";import{y as q,P as Y}from"./PortalLayout-u-5QNYDI.js";import{S as C}from"./sweetalert2.esm.all-89IKscqO.js";import{x as w}from"./useData-Bpd0XriX.js";import{S as y}from"./react-select.esm-BkhK0xLv.js";import{u as F}from"./useErrorToast-B9XNEQ0p.js";import{M as b}from"./Modal-Cs-ZlOYu.js";import{F as h}from"./Form-CnKhehiI.js";import{R as v}from"./Row-B4t5VXUr.js";import{C as c}from"./Col-CcX1xzGs.js";import{B as D}from"./warning-DViRBwvh.js";import{a as N}from"./helpers-DALsaz0e.js";import{B as G}from"./ButtonGroup-eq7KuXkt.js";import{m as z}from"./proxy-DX8jdYJD.js";import{C as A}from"./Card-ClEnLKUp.js";import{T as K}from"./Table-M2KRe3ue.js";import"./CloseButton-BYbBlkTD.js";import"./ElementChildren-C0T05OxF.js";import"./Badge-DAm-MJP0.js";const E=()=>{const j=Date.now(),m="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";return"EX-"+j+"-"+Array.from({length:3},()=>m.charAt(Math.floor(Math.random()*m.length))).join("")};function W({show:j,onHide:m,exam:a=null,terms:g=[],classes:p=[],streams:_=[]}){const r=!!a,{showErrorToast:T}=F(),{data:s,setData:i,processing:n,reset:l}=P({name:"",code:E(),term_id:"",start_date:"",end_date:"",max_score:100,is_active:!0,class_ids:[],stream_ids:[]}),u=d.useMemo(()=>g.map(t=>({value:t.id,label:t.name})),[g]),x=d.useMemo(()=>p.map(t=>({value:t.id,label:t.name})),[p]),S=d.useMemo(()=>_.map(t=>({value:t.id,label:t.name})),[_]);d.useEffect(()=>{var t,o;r?i({name:a.name??"",code:a.code??E(),term_id:a.term_id??"",start_date:a.start_date?a.start_date.split("T")[0]:"",end_date:a.end_date?a.end_date.split("T")[0]:"",max_score:a.max_score??100,is_active:a.is_active??!0,class_ids:((t=a.classes)==null?void 0:t.map(f=>f.id))??[],stream_ids:((o=a.streams)==null?void 0:o.map(f=>f.id))??[]}):(l(),i("code",E()))},[a,r]);const O=async t=>{var f;t.preventDefault();const o=r?"Update":"Create";try{if(!(await C.fire({title:`${o} Exam`,text:`Confirm to ${o.toLowerCase()} this exam.`,icon:"question",showCancelButton:!0,confirmButtonText:"Yes",cancelButtonText:"Cancel",reverseButtons:!0})).isConfirmed)return;C.fire({title:"Please wait...",text:`${o} in progress`,icon:"info",allowOutsideClick:!1,allowEscapeKey:!1,didOpen:()=>C.showLoading()});const k=r?route("admin.exam.update",a.id):route("admin.exam.store"),M=r?await w.put(k,s):await w.post(k,s);(f=M.data)!=null&&f.success&&(q.success(M.data.message),l(),m())}catch(B){T(B)}finally{C.close()}};return e.jsx(b,{show:j,onHide:m,size:"lg",centered:!0,children:e.jsxs(h,{onSubmit:O,children:[e.jsx(b.Header,{closeButton:!0,children:e.jsx(b.Title,{children:r?"Edit Exam":"Create Exam"})}),e.jsxs(b.Body,{children:[e.jsxs(v,{className:"mb-3",children:[e.jsx(c,{md:6,children:e.jsx(h.Control,{value:s.code,disabled:!0,className:"bg-light"})}),e.jsx(c,{md:6,children:e.jsx(h.Control,{placeholder:"Exam Name (e.g. Midterm Exam)",value:s.name,onChange:t=>i("name",t.target.value),required:!0})})]}),e.jsxs(v,{className:"mb-3",children:[e.jsx(c,{md:4,children:e.jsx(y,{options:u,value:u.find(t=>t.value===s.term_id),onChange:t=>i("term_id",(t==null?void 0:t.value)||""),placeholder:"Select Term",isClearable:!0})}),e.jsx(c,{md:4,children:e.jsx(y,{isMulti:!0,options:x,value:x.filter(t=>s.class_ids.includes(t.value)),onChange:t=>i("class_ids",t.map(o=>o.value)),placeholder:"Assign to Classes"})}),e.jsx(c,{md:4,children:e.jsx(y,{isMulti:!0,options:S,value:S.filter(t=>s.stream_ids.includes(t.value)),onChange:t=>i("stream_ids",t.map(o=>o.value)),placeholder:"Assign to Streams"})})]}),e.jsxs(v,{className:"mb-3",children:[e.jsx(c,{children:e.jsx(h.Control,{type:"date",value:s.start_date,onChange:t=>i("start_date",t.target.value),required:!0})}),e.jsx(c,{children:e.jsx(h.Control,{type:"date",value:s.end_date,onChange:t=>i("end_date",t.target.value),required:!0})})]}),e.jsx(v,{className:"mb-3",children:e.jsx(c,{children:e.jsx(h.Control,{type:"number",step:"0.01",value:s.max_score,onChange:t=>i("max_score",t.target.value),required:!0})})}),e.jsx(h.Check,{type:"switch",label:"Active",checked:s.is_active,onChange:t=>i("is_active",t.target.checked)})]}),e.jsxs(b.Footer,{children:[e.jsx(D,{variant:"secondary",onClick:m,disabled:n,children:"Cancel"}),e.jsx(D,{variant:"primary",type:"submit",disabled:n,children:n?`${r?"Updating":"Saving"}...`:r?"Update":"Save"})]})]})})}function xe({terms:j=[]}){const{auth:m}=L().props,{showErrorToast:a}=F(),[g,p]=d.useState(!1),[_,r]=d.useState(null),T=d.useCallback(()=>{$.fn.DataTable.isDataTable("#examsTable")&&$("#examsTable").DataTable().destroy(),$("#examsTable").DataTable({processing:!0,serverSide:!0,ajax:{url:route("admin.exam.index"),type:"GET"},columns:[{data:"name",title:"Name"},{data:"term.name",title:"Term"},{data:"term.academic_year.name",title:"Ac/Year"},{data:"start_date",title:"From",render:function(n,l,u,x){return N(n)}},{data:"end_date",title:"To",render:function(n,l,u,x){return N(n)}},{data:"published",title:"Published"},{data:"action",title:"Actions",className:"text-end"}],order:[[0,"asc"]],responsive:!0,autoWidth:!1})},[]),s=d.useCallback(async n=>{try{if(!(await C.fire({title:"Delete Exam?",text:"Are you sure?",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed)return;await w.delete(route("admin.exam.destroy",n)),$("#examsTable").DataTable().ajax.reload(null,!1),q.success("Exam deleted successfully!")}catch(l){a(l)}},[]);d.useEffect(()=>{T();const n=u=>{const x=$(u.currentTarget).data("data");r(x),p(!0)},l=u=>{const x=$(u.currentTarget).data("id");s(x)};return $(document).on("click",".edit-btn",n),$(document).on("click",".delete-btn",l),()=>{$.fn.DataTable.isDataTable("#examsTable")&&$("#examsTable").DataTable().destroy(),$(document).off("click",".edit-btn",n),$(document).off("click",".delete-btn",l)}},[T,s]);const i=d.useCallback(()=>{p(!1),r(null),$("#examsTable").DataTable().ajax.reload(null,!1)},[]);return e.jsxs(Y,{user:m.user,children:[e.jsx(R,{title:"Exams"}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h1",{className:"h3 mb-0",children:"Exams"}),e.jsx(G,{children:e.jsxs(D,{variant:"outline-primary",onClick:()=>{r(null),p(!0)},children:[e.jsx(U,{className:"me-1"})," New Exam"]})})]}),e.jsx("hr",{className:"dashed-hr"}),e.jsx(v,{children:e.jsx(c,{children:e.jsx(z.div,{initial:{opacity:0},animate:{opacity:1},children:e.jsx(A,{children:e.jsx(A.Body,{children:e.jsx(K,{id:"examsTable",className:"w-100 table-striped table-bordered",responsive:!0})})})})})}),e.jsx(W,{terms:j,show:g,onHide:i,exam:_})]})}export{xe as default};
