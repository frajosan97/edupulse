import{r as p,j as e,a as H,J as W,d as Y,f as Q}from"./app-CiDaUcey.js";import{P as Z,y as ee}from"./PortalLayout-CxqdbcvG.js";import{q as se,a1 as ae,H as B,a2 as k,a3 as re,z as E,a4 as ne,a5 as le,a6 as ie,$ as te}from"./index-NpM1gPvR.js";import{u as oe,S as de,c as ce,a as h,b as me}from"./index.esm-BoFaiIfe.js";import{S as P}from"./react-select.esm-Le_u87zZ.js";import{S as f}from"./sweetalert2.esm.all-89IKscqO.js";import{u as he}from"./useErrorToast-CTAe8NjK.js";import{u as ue}from"./useTenantData-BMZHPJaF.js";import{B as L}from"./Badge-B8SxXTMH.js";import{C as I,B as y}from"./warning-CDyBO85i.js";import{B as pe}from"./ButtonGroup-Bf8VZ0Fe.js";import{F as a}from"./Form-DY59OgGH.js";import{T as b}from"./Tab-BBitmCVB.js";import{C as d}from"./Card-O6qekqvm.js";import{N as _}from"./useData-CInDpAgI.js";import{R as g}from"./Row-DoEZsrd7.js";import{C as i}from"./Col-H7LL1jeG.js";import{I as G}from"./Image-BQGTw1Pt.js";import"./CloseButton-uf0rwOsm.js";import"./ElementChildren-Ykn35dyp.js";const c=[{key:"personal",label:"Personal Details",icon:e.jsx(te,{}),color:"#4f46e5"},{key:"status",label:"Status",icon:e.jsx(E,{}),color:"#7c3aed"}],T={token:"",first_name:"",last_name:"",other_name:"",email:"",email_verified_at:"",profile_image:null,signature:null,phone:"",gender:"",is_active:!0,password:"",password_confirmation:"",role:"",department_id:null},xe=ce({first_name:h().required("First name is required").min(3,"Minimum 3 characters"),last_name:h().required("Last name is required").min(3,"Minimum 3 characters"),email:h().email("Invalid email").required("Email is required"),phone:h().required("Phone number is required").min(10,"Minimum 10 characters"),gender:h().oneOf(["male","female","other"],"Invalid gender selection"),role:h().required("Role is required"),password:h().min(8,"Password must be at least 8 characters").when("$isEdit",(l,m)=>l?m:m.required("Password is required")),password_confirmation:h().oneOf([me("password"),null],"Passwords must match").when("$isEdit",(l,m)=>l?m:m.required("Confirm password is required"))});function $e({staff:l=null,departments:m=[]}){var F;const{roles:q}=ue(),{showErrorToast:U}=he(),o=!!l,[t,v]=p.useState("personal"),[w,je]=p.useState(!1),[N,$]=p.useState((l==null?void 0:l.profile_image_url)||null),[C,A]=p.useState((l==null?void 0:l.signature_url)||null),s=oe({initialValues:o?{...T,...l,password:"",password_confirmation:""}:T,validationSchema:xe,enableReinitialize:!0,context:{isEdit:o},onSubmit:async r=>{const n=o?"Update":"Create";try{if(!(await f.fire({title:`${n} Staff`,text:`Confirm to ${n.toLowerCase()} this staff.`,icon:"question",showCancelButton:!0,confirmButtonText:"Yes",cancelButtonText:"Cancel",reverseButtons:!0})).isConfirmed)return;f.fire({title:"Please wait...",text:`${n} in progress`,icon:"info",allowOutsideClick:!1,allowEscapeKey:!1,didOpen:()=>f.showLoading()});const u=new FormData;for(const j in r)r[j]!==null&&r[j]!==void 0&&u.append(j,r[j]);const V=o?route("admin.staff.update",l.id):route("admin.staff.store"),J="post";o&&u.append("_method","PUT");const fe=await Y[J](V,u,{headers:{"Content-Type":"multipart/form-data"}});ee.success(o?"Staff updated successfully!":"Staff created successfully!"),Q.visit(route("admin.staff.index"))}catch(x){U(x)}finally{f.close()}}}),R=r=>{const n=r.currentTarget.files[0];n&&(s.setFieldValue("profile_image",n),$(URL.createObjectURL(n)))},z=r=>{const n=r.currentTarget.files[0];n&&(s.setFieldValue("signature",n),A(URL.createObjectURL(n)))},O=t===c[0].key,X=t===c[c.length-1].key,D=p.useCallback(()=>{const r=c.findIndex(n=>n.key===t);r<c.length-1&&v(c[r+1].key)},[t]),M=p.useCallback(()=>{const r=c.findIndex(n=>n.key===t);r>0&&v(c[r-1].key)},[t]),K=p.useCallback(()=>s.values.is_active?e.jsxs(L,{bg:"success",className:"fs-6 px-3 py-2",children:[e.jsx(se,{className:"me-1"}),"Active"]}):e.jsx(L,{bg:"secondary",className:"fs-6 px-3 py-2",children:"Inactive"}),[s.values.is_active]);c.find(r=>r.key===t);const S=o?`Edit ${l==null?void 0:l.full_name}`:"Create New Staff";return e.jsxs(Z,{children:[e.jsx(H,{title:S}),e.jsxs(I,{fluid:!0,className:"mb-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h2",{className:"m-0 text-capitalize",children:S}),e.jsx(pe,{children:e.jsxs(W,{href:route("admin.staff.index"),className:"btn btn-outline-primary",children:[e.jsx(ae,{className:"me-2"}),"Back to Staff"]})})]}),e.jsx("hr",{className:"dashed-hr mt-2"})]}),e.jsx(I,{fluid:!0,children:e.jsx(a,{onSubmit:s.handleSubmit,encType:"multipart/form-data",children:e.jsx(b.Container,{activeKey:t,onSelect:v,children:e.jsxs(d,{className:"shadow-sm border-0 mb-4",children:[e.jsx(d.Header,{className:"bg-white border-0 pb-0",children:e.jsx(_,{variant:"tabs",className:"border-0",children:c.map(({key:r,label:n,icon:x,color:u})=>e.jsx(_.Item,{children:e.jsx(_.Link,{eventKey:r,className:`px-4 py-3 rounded-0 border-0 ${t===r?"border-bottom-3":""}`,style:{color:t===r?u:"#6b7280",fontWeight:t===r?"600":"400",borderBottom:t===r?`3px solid ${u}`:"3px solid transparent",backgroundColor:"transparent"},children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"me-2",style:{color:t===r?u:"#9ca3af"},children:x}),e.jsx("span",{children:n})]})})},r))})}),e.jsx(d.Body,{children:e.jsxs(b.Content,{children:[e.jsx(b.Pane,{eventKey:"personal",children:e.jsxs(g,{className:"g-4",children:[e.jsx(i,{md:4,lg:3,children:e.jsx(d,{className:"border-0 bg-light",children:e.jsxs(d.Body,{className:"text-center p-4",children:[e.jsx("div",{className:"mb-3",children:N?e.jsx(G,{src:N,roundedCircle:!0,fluid:!0,className:"border shadow-sm",style:{width:120,height:120,objectFit:"cover"}}):e.jsx("div",{className:"border rounded-circle d-flex justify-content-center align-items-center bg-white mx-auto",style:{width:120,height:120},children:e.jsx(B,{size:50,className:"text-muted"})})}),e.jsxs(a.Group,{children:[e.jsxs(a.Label,{className:"btn btn-outline-primary btn-sm w-100 cursor-pointer mb-0",htmlFor:"profile_image",children:[e.jsx(B,{className:"me-2"}),N?"Change Photo":"Upload Photo"]}),e.jsx(a.Control,{type:"file",id:"profile_image",name:"profile_image",accept:"image/*",onChange:R,className:"d-none"})]}),e.jsx("div",{className:"small text-muted mt-2",children:"JPG, PNG or GIF. Max 2MB."}),e.jsx("div",{className:"mt-4",children:C?e.jsx(G,{src:C,fluid:!0,className:"border shadow-sm",style:{width:150,height:80,objectFit:"contain"}}):e.jsx("div",{className:"border d-flex justify-content-center align-items-center bg-white mx-auto",style:{width:150,height:80},children:e.jsx(k,{size:30,className:"text-muted"})})}),e.jsxs(a.Group,{className:"mt-2",children:[e.jsxs(a.Label,{className:"btn btn-outline-secondary btn-sm w-100 cursor-pointer mb-0",htmlFor:"signature",children:[e.jsx(k,{className:"me-2"}),C?"Change Signature":"Upload Signature"]}),e.jsx(a.Control,{type:"file",id:"signature",name:"signature",accept:"image/*",onChange:z,className:"d-none"})]})]})})}),e.jsx(i,{md:8,lg:9,children:e.jsxs(g,{className:"g-3",children:[e.jsx(i,{md:4,children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{className:"fw-semibold",children:"Surname *"}),e.jsx(a.Control,{name:"last_name",value:s.values.last_name,onChange:s.handleChange,onBlur:s.handleBlur,isInvalid:s.touched.last_name&&!!s.errors.last_name,placeholder:"Enter surname",className:"py-2"}),e.jsx(a.Control.Feedback,{type:"invalid",children:s.errors.last_name})]})}),e.jsx(i,{md:4,children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{className:"fw-semibold",children:"First Name *"}),e.jsx(a.Control,{name:"first_name",value:s.values.first_name,onChange:s.handleChange,onBlur:s.handleBlur,isInvalid:s.touched.first_name&&!!s.errors.first_name,placeholder:"Enter first name",className:"py-2"}),e.jsx(a.Control.Feedback,{type:"invalid",children:s.errors.first_name})]})}),e.jsx(i,{md:4,children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{className:"fw-semibold",children:"Other Name"}),e.jsx(a.Control,{name:"other_name",value:s.values.other_name,onChange:s.handleChange,onBlur:s.handleBlur,isInvalid:s.touched.other_name&&!!s.errors.other_name,placeholder:"Enter other name",className:"py-2"}),e.jsx(a.Control.Feedback,{type:"invalid",children:s.errors.other_name})]})}),e.jsx(i,{md:6,children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{className:"fw-semibold",children:"Email Address *"}),e.jsx(a.Control,{type:"email",name:"email",value:s.values.email,onChange:s.handleChange,onBlur:s.handleBlur,isInvalid:s.touched.email&&!!s.errors.email,placeholder:"staff@example.com",className:"py-2"}),e.jsx(a.Control.Feedback,{type:"invalid",children:s.errors.email})]})}),e.jsx(i,{md:6,children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{className:"fw-semibold",children:"Phone Number *"}),e.jsx(a.Control,{name:"phone",value:s.values.phone,onChange:s.handleChange,onBlur:s.handleBlur,isInvalid:s.touched.phone&&!!s.errors.phone,placeholder:"+254 XXX XXX XXX",className:"py-2"}),e.jsx(a.Control.Feedback,{type:"invalid",children:s.errors.phone})]})}),e.jsx(i,{md:6,children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{className:"fw-semibold",children:"Gender"}),e.jsxs(a.Select,{name:"gender",value:s.values.gender,onChange:s.handleChange,onBlur:s.handleBlur,isInvalid:s.touched.gender&&!!s.errors.gender,className:"py-2",children:[e.jsx("option",{value:"",children:"Select Gender"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"other",children:"Other"})]}),e.jsx(a.Control.Feedback,{type:"invalid",children:s.errors.gender})]})}),e.jsx(i,{md:6,children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{className:"fw-semibold",children:"Department"}),e.jsx(P,{name:"department_id",options:m.map(r=>({value:r.id,label:r.name})),value:s.values.department_id?{value:s.values.department_id,label:(F=m.find(r=>r.id===s.values.department_id))==null?void 0:F.name}:null,onChange:r=>s.setFieldValue("department_id",(r==null?void 0:r.value)||null),onBlur:s.handleBlur,placeholder:"Select department",className:"react-select-container",classNamePrefix:"react-select"})]})}),e.jsx(i,{md:12,children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{className:"fw-semibold",children:"Role *"}),e.jsx(P,{name:"role",options:q.map(r=>({value:r.name,label:r.name})),value:s.values.role?{value:s.values.role,label:s.values.role}:null,onChange:r=>s.setFieldValue("role",(r==null?void 0:r.value)||""),onBlur:s.handleBlur,isInvalid:s.touched.role&&!!s.errors.role,placeholder:"Select staff role",className:"react-select-container",classNamePrefix:"react-select"}),s.touched.role&&s.errors.role&&e.jsx("div",{className:"invalid-feedback d-block",children:s.errors.role})]})}),!o&&e.jsxs(e.Fragment,{children:[e.jsx(i,{md:6,children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{className:"fw-semibold",children:"Password *"}),e.jsx(a.Control,{type:"password",name:"password",value:s.values.password,onChange:s.handleChange,onBlur:s.handleBlur,isInvalid:s.touched.password&&!!s.errors.password,placeholder:"Enter password",className:"py-2"}),e.jsx(a.Control.Feedback,{type:"invalid",children:s.errors.password})]})}),e.jsx(i,{md:6,children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{className:"fw-semibold",children:"Confirm Password *"}),e.jsx(a.Control,{type:"password",name:"password_confirmation",value:s.values.password_confirmation,onChange:s.handleChange,onBlur:s.handleBlur,isInvalid:s.touched.password_confirmation&&!!s.errors.password_confirmation,placeholder:"Confirm password",className:"py-2"}),e.jsx(a.Control.Feedback,{type:"invalid",children:s.errors.password_confirmation})]})})]})]})})]})}),e.jsx(b.Pane,{eventKey:"status",children:e.jsxs(g,{className:"g-4",children:[e.jsxs(i,{lg:8,children:[e.jsx(d,{className:"border-0 bg-light",children:e.jsxs(d.Body,{className:"p-4",children:[e.jsx("h6",{className:"fw-bold mb-3",children:"Staff Status"}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between p-3 bg-white rounded-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",children:"Account Status"}),e.jsx("small",{className:"text-muted",children:s.values.is_active?"This staff member is active and can access the system":"This staff member is inactive and cannot access the system"})]}),e.jsx(a.Check,{type:"switch",id:"is_active",name:"is_active",checked:s.values.is_active,onChange:s.handleChange,style:{transform:"scale(1.2)"}})]})]})}),o&&e.jsx(d,{className:"border-0 bg-light mt-4",children:e.jsxs(d.Body,{className:"p-4",children:[e.jsxs("h6",{className:"fw-bold text-warning mb-3",children:[e.jsx(re,{className:"me-2"}),"Password Update"]}),e.jsx("p",{className:"text-muted mb-3",children:"Leave password fields blank to keep current password."}),e.jsxs(g,{className:"g-3",children:[e.jsx(i,{md:6,children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{className:"fw-semibold",children:"New Password"}),e.jsx(a.Control,{type:"password",name:"password",value:s.values.password,onChange:s.handleChange,onBlur:s.handleBlur,isInvalid:s.touched.password&&!!s.errors.password,placeholder:"Enter new password",className:"py-2"}),e.jsx(a.Control.Feedback,{type:"invalid",children:s.errors.password})]})}),e.jsx(i,{md:6,children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{className:"fw-semibold",children:"Confirm New Password"}),e.jsx(a.Control,{type:"password",name:"password_confirmation",value:s.values.password_confirmation,onChange:s.handleChange,onBlur:s.handleBlur,isInvalid:s.touched.password_confirmation&&!!s.errors.password_confirmation,placeholder:"Confirm new password",className:"py-2"}),e.jsx(a.Control.Feedback,{type:"invalid",children:s.errors.password_confirmation})]})})]})]})})]}),e.jsx(i,{lg:4,children:e.jsx(d,{className:"border-0 bg-primary bg-opacity-10",children:e.jsxs(d.Body,{className:"p-4",children:[e.jsxs("h6",{className:"fw-bold text-primary mb-3",children:[e.jsx(E,{className:"me-2"}),"Status Overview"]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"small text-muted mb-1",children:"Current Status"}),K()]}),e.jsx("p",{className:"small text-muted mb-0",children:"Active staff can log in and perform their assigned roles. Inactive staff cannot access the system but their data is preserved."})]})})})]})})]})}),e.jsx(d.Footer,{className:"bg-light border-0 py-4",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs(y,{variant:"outline-secondary",onClick:M,disabled:O||w,className:"px-4 py-2 d-flex align-items-center",children:[e.jsx(ne,{className:"me-2",size:18}),"Previous"]}),e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("span",{className:"text-muted me-3 small",children:["Step"," ",c.findIndex(r=>r.key===t)+1," ","of ",c.length]}),X?e.jsx(y,{variant:"primary",type:"submit",disabled:w,className:"px-4 py-2 d-flex align-items-center",children:w?e.jsxs(e.Fragment,{children:[e.jsx(de,{animation:"border",size:"sm",className:"me-2"}),o?"Updating...":"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"me-2",size:18}),o?"Update Staff":"Create Staff"]})}):e.jsxs(y,{variant:"primary",onClick:D,className:"px-4 py-2 d-flex align-items-center",children:["Next",e.jsx(ie,{className:"ms-2",size:18})]})]})]})})]})})})})]})}export{$e as default};
