import{S as B,r as d,j as e,q as E,a as S}from"./app-CiDaUcey.js";import{G as A,e as N}from"./index-NpM1gPvR.js";import{y,P as L}from"./PortalLayout-CxqdbcvG.js";import{S as x}from"./sweetalert2.esm.all-89IKscqO.js";import{x as C}from"./useData-CInDpAgI.js";import{u as q}from"./useErrorToast-CTAe8NjK.js";import{M as f}from"./Modal-CviNt8xm.js";import{F as l}from"./Form-DY59OgGH.js";import{R as j}from"./Row-DoEZsrd7.js";import{C as h}from"./Col-H7LL1jeG.js";import{I as _}from"./InputGroup-B5mTNa8N.js";import{B as T}from"./warning-CDyBO85i.js";import{a as Y}from"./helpers-CqFYgsdY.js";import{B as F}from"./ButtonGroup-Bf8VZ0Fe.js";import{m as M}from"./proxy-CjJB-Dek.js";import{C as k}from"./Card-O6qekqvm.js";import{T as G}from"./Table-CC8sxR3u.js";import"./CloseButton-uf0rwOsm.js";import"./ElementChildren-Ykn35dyp.js";import"./Badge-B8SxXTMH.js";function P({show:b,onHide:m,academicYear:r=null}){const i=!!r,{showErrorToast:u}=q(),{data:n,setData:c,processing:p,reset:s}=B({name:"",start_date:"",end_date:"",is_active:!0});d.useEffect(()=>{i?c({name:r.name??"",start_date:r.start_date??"",end_date:r.end_date??"",is_active:r.is_active??!0}):s()},[r,i]);const o=async a=>{var v;a.preventDefault();const t=i?"Update":"Create";try{if(!(await x.fire({title:`${t} Academic Year`,text:`Confirm to ${t.toLowerCase()} this academic year.`,icon:"question",showCancelButton:!0,confirmButtonText:"Yes",cancelButtonText:"Cancel",reverseButtons:!0})).isConfirmed)return;x.fire({title:"Please wait...",text:`${t} in progress`,icon:"info",allowOutsideClick:!1,allowEscapeKey:!1,didOpen:()=>x.showLoading()});const w=i?route("admin.academic-year.update",r.id):route("admin.academic-year.store"),D=i?await C.put(w,n):await C.post(w,n);(v=D.data)!=null&&v.success&&(y.success(D.data.message),s(),m())}catch(g){u(g)}finally{x.close()}};return e.jsx(f,{show:b,onHide:m,centered:!0,children:e.jsxs(l,{onSubmit:o,children:[e.jsx(f.Header,{closeButton:!0,children:e.jsx(f.Title,{children:i?"Edit Academic Year":"Create Academic Year"})}),e.jsxs(f.Body,{children:[e.jsx(j,{className:"mb-3",children:e.jsx(h,{children:e.jsxs(_,{children:[e.jsx(_.Text,{children:e.jsx(A,{})}),e.jsx(l.Control,{placeholder:"Name (e.g. 2024/2025)",value:n.name,onChange:a=>c("name",a.target.value),required:!0})]})})}),e.jsxs(j,{className:"mb-3",children:[e.jsxs(h,{children:[e.jsx(l.Label,{children:"Start Date"}),e.jsx(l.Control,{type:"date",value:n.start_date,onChange:a=>c("start_date",a.target.value),required:!0})]}),e.jsxs(h,{children:[e.jsx(l.Label,{children:"End Date"}),e.jsx(l.Control,{type:"date",value:n.end_date,onChange:a=>c("end_date",a.target.value),required:!0})]})]}),e.jsx(j,{children:e.jsx(h,{children:e.jsx(l.Check,{type:"checkbox",label:"Active",checked:n.is_active,onChange:a=>c("is_active",a.target.checked)})})})]}),e.jsxs(f.Footer,{children:[e.jsx(T,{variant:"secondary",onClick:m,children:"Cancel"}),e.jsx(T,{variant:"primary",type:"submit",disabled:p,children:p?"Saving...":i?"Update":"Save"})]})]})})}function oe(){const{auth:b}=E().props,[m,r]=d.useState(!1),[i,u]=d.useState(null),n=d.useCallback(()=>{$.fn.DataTable.isDataTable("#academicYearsTable")&&$("#academicYearsTable").DataTable().destroy(),$("#academicYearsTable").DataTable({processing:!0,serverSide:!0,ajax:{url:route("admin.academic-year.index"),type:"GET"},columns:[{data:"name",title:"Name"},{data:"is_active",title:"Active"},{data:"start_date",title:"Start Date",render:function(s,o,a,t){return Y(s)}},{data:"end_date",title:"End Date",render:function(s,o,a,t){return Y(s)}},{data:"terms_count",title:"Terms"},{data:"status",title:"Status"},{data:"action",title:"Actions",className:"text-end"}],order:[[0,"asc"]],responsive:!0,autoWidth:!1})},[]),c=d.useCallback(async s=>{var o,a;try{if(!(await x.fire({title:"Delete Academic Year?",text:"Are you sure?",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel",reverseButtons:!0})).isConfirmed)return;await C.delete(route("admin.academic-years.destroy",s)),$("#academicYearsTable").DataTable().ajax.reload(null,!1),y.success("Academic Year deleted successfully!")}catch(t){y.error(((a=(o=t==null?void 0:t.response)==null?void 0:o.data)==null?void 0:a.message)||"Error deleting.")}},[]);d.useEffect(()=>{n();const s=a=>{const t=$(a.currentTarget).data("data");u(t),r(!0)},o=a=>{const t=$(a.currentTarget).data("id");c(t)};return $(document).on("click",".edit-btn",s),$(document).on("click",".delete-btn",o),()=>{$.fn.DataTable.isDataTable("#academicYearsTable")&&$("#academicYearsTable").DataTable().destroy(),$(document).off("click",".edit-btn",s),$(document).off("click",".delete-btn",o)}},[n,c]);const p=d.useCallback(()=>{r(!1),u(null),$("#academicYearsTable").DataTable().ajax.reload(null,!1)},[]);return e.jsxs(L,{user:b.user,children:[e.jsx(S,{title:"Academic Years"}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h1",{className:"h3 mb-0",children:"Academic Years"}),e.jsx(F,{children:e.jsxs(T,{variant:"outline-primary",onClick:()=>{u(null),r(!0)},children:[e.jsx(N,{className:"me-1"})," New Year"]})})]}),e.jsx("hr",{className:"dashed-hr"}),e.jsx(j,{children:e.jsx(h,{children:e.jsx(M.div,{initial:{opacity:0},animate:{opacity:1},children:e.jsx(k,{children:e.jsx(k.Body,{children:e.jsx(G,{id:"academicYearsTable",className:"w-100 table-striped table-bordered",responsive:!0})})})})})}),e.jsx(P,{show:m,onHide:p,academicYear:i})]})}export{oe as default};
