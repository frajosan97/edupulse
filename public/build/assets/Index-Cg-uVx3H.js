import{S as A,r as m,j as e,f as q,q as H,a as U}from"./app-bV1oKjKy.js";import{C as z,D as W,ab as P,ac as Y,r as R,s as K,e as J}from"./index-6KH3gXbP.js";import{y as k,B as Q,a as V,P as X}from"./PortalLayout-u-5QNYDI.js";import{S as b}from"./sweetalert2.esm.all-89IKscqO.js";import{x as B}from"./useData-Bpd0XriX.js";import{S as D}from"./react-select.esm-BkhK0xLv.js";import{u as E}from"./useErrorToast-B9XNEQ0p.js";import{M as h}from"./Modal-Cs-ZlOYu.js";import{F as o}from"./Form-CnKhehiI.js";import{R as x}from"./Row-B4t5VXUr.js";import{C as l}from"./Col-CcX1xzGs.js";import{I as T}from"./InputGroup-C1XhqFRU.js";import{B as w}from"./warning-DViRBwvh.js";import{b as Z}from"./helpers-DALsaz0e.js";import{T as O}from"./Table-M2KRe3ue.js";import{B as I}from"./ButtonGroup-eq7KuXkt.js";import{m as ee}from"./proxy-DX8jdYJD.js";import{C as F}from"./Card-ClEnLKUp.js";import"./CloseButton-BYbBlkTD.js";import"./ElementChildren-C0T05OxF.js";import"./Badge-DAm-MJP0.js";function te({show:_,onHide:g,subject:i=null,subjectGroups:f=[],departments:p=[],gradingSystems:j=[]}){var d,a,S;const c=!!i,{data:s,setData:r,processing:C,reset:v}=A({name:"",code:"",short_name:"",description:"",subject_group_id:"",department_id:"",grading_system_id:"",type:"core",has_theory:!0,has_practical:!1,theory_hours:"",practical_hours:"",passing_score:"",max_score:100,theory_weightage:"",practical_weightage:"",is_active:!0}),{showErrorToast:y}=E();m.useEffect(()=>{c&&i?r({...s,...i}):v()},[i,c]);const u=async t=>{t.preventDefault();const N=c?"Update":"Create";try{if(!(await b.fire({title:`${N} Subject`,text:`Confirm to ${N.toLowerCase()} this subject.`,icon:"question",showCancelButton:!0,confirmButtonText:"Yes",cancelButtonText:"Cancel",reverseButtons:!0})).isConfirmed)return;b.fire({title:"Please wait...",text:`${N} in progress`,icon:"info",allowOutsideClick:!1,allowEscapeKey:!1,didOpen:()=>b.showLoading()});const M=c?route("admin.subject.update",i.id):route("admin.subject.store"),L=c?await B.put(M,s):await B.post(M,s);L.data.success&&(k.success(L.data.message||`Subject ${N.toLowerCase()}d successfully!`),v(),g())}catch(G){y(G)}finally{b.close()}},n=[{value:"core",label:"Core"},{value:"elective",label:"Elective"},{value:"additional",label:"Additional"},{value:"optional",label:"Optional"}];return e.jsx(h,{show:_,onHide:g,size:"lg",centered:!0,children:e.jsxs(o,{onSubmit:u,children:[e.jsx(h.Header,{closeButton:!0,children:e.jsx(h.Title,{children:c?"Edit Subject":"Create Subject"})}),e.jsxs(h.Body,{children:[e.jsxs(x,{className:"mb-3",children:[e.jsx(l,{md:6,children:e.jsxs(T,{children:[e.jsx(T.Text,{children:e.jsx(z,{})}),e.jsx(o.Control,{placeholder:"Subject Name",value:s.name,onChange:t=>r("name",t.target.value),required:!0})]})}),e.jsx(l,{md:6,children:e.jsxs(T,{children:[e.jsx(T.Text,{children:e.jsx(W,{})}),e.jsx(o.Control,{placeholder:"Code",value:s.code,onChange:t=>r("code",t.target.value),required:!0})]})})]}),e.jsxs(x,{className:"mb-3",children:[e.jsx(l,{md:6,children:e.jsx(o.Control,{placeholder:"Short Name",value:s.short_name,onChange:t=>r("short_name",t.target.value)})}),e.jsx(l,{md:6,children:e.jsx(D,{options:n,value:n.find(t=>t.value===s.type),onChange:t=>r("type",(t==null?void 0:t.value)||""),placeholder:"Select Subject Type"})})]}),e.jsxs(x,{className:"mb-3",children:[e.jsx(l,{md:6,children:e.jsx(D,{options:f.map(t=>({value:t.id,label:t.name})),value:f.find(t=>t.id===s.subject_group_id)?{value:s.subject_group_id,label:(d=f.find(t=>t.id===s.subject_group_id))==null?void 0:d.name}:null,onChange:t=>r("subject_group_id",(t==null?void 0:t.value)||""),placeholder:"Select Subject Group"})}),e.jsx(l,{md:6,children:e.jsx(D,{options:p.map(t=>({value:t.id,label:t.name})),value:p.find(t=>t.id===s.department_id)?{value:s.department_id,label:(a=p.find(t=>t.id===s.department_id))==null?void 0:a.name}:null,onChange:t=>r("department_id",(t==null?void 0:t.value)||""),placeholder:"Select Department"})})]}),e.jsx(x,{className:"mb-3",children:e.jsx(l,{md:12,children:e.jsx(D,{options:j.map(t=>({value:t.id,label:t.name})),value:j.find(t=>t.id===s.grading_system_id)?{value:s.grading_system_id,label:(S=j.find(t=>t.id===s.grading_system_id))==null?void 0:S.name}:null,onChange:t=>r("grading_system_id",(t==null?void 0:t.value)||""),placeholder:"Select Grading System"})})}),e.jsx(x,{className:"mb-3",children:e.jsx(l,{md:12,children:e.jsx(o.Control,{as:"textarea",rows:1,placeholder:"Description",value:s.description,onChange:t=>r("description",t.target.value)})})}),e.jsxs(x,{className:"mb-3",children:[e.jsx(l,{md:3,children:e.jsx(o.Check,{label:"Has Theory",checked:s.has_theory,onChange:t=>r("has_theory",t.target.checked)})}),e.jsx(l,{md:3,children:e.jsx(o.Check,{label:"Has Practical",checked:s.has_practical,onChange:t=>r("has_practical",t.target.checked)})}),e.jsx(l,{md:3,children:e.jsx(o.Check,{label:"Active",checked:s.is_active,onChange:t=>r("is_active",t.target.checked)})})]}),e.jsxs(x,{className:"mb-3",children:[e.jsx(l,{md:6,children:e.jsx(o.Control,{type:"number",placeholder:"Theory Hours",value:s.theory_hours,onChange:t=>r("theory_hours",t.target.value)})}),e.jsx(l,{md:6,children:e.jsx(o.Control,{type:"number",placeholder:"Practical Hours",value:s.practical_hours,onChange:t=>r("practical_hours",t.target.value)})})]}),e.jsxs(x,{className:"mb-3",children:[e.jsx(l,{md:6,children:e.jsx(o.Control,{type:"number",step:"0.01",placeholder:"Passing Score",value:s.passing_score,onChange:t=>r("passing_score",t.target.value)})}),e.jsx(l,{md:6,children:e.jsx(o.Control,{type:"number",step:"0.01",placeholder:"Max Score",value:s.max_score,onChange:t=>r("max_score",t.target.value)})})]}),e.jsxs(x,{className:"mb-3",children:[e.jsx(l,{md:6,children:e.jsx(o.Control,{type:"number",step:"0.01",placeholder:"Theory Weightage (%)",value:s.theory_weightage,onChange:t=>r("theory_weightage",t.target.value)})}),e.jsx(l,{md:6,children:e.jsx(o.Control,{type:"number",step:"0.01",placeholder:"Practical Weightage (%)",value:s.practical_weightage,onChange:t=>r("practical_weightage",t.target.value)})})]})]}),e.jsxs(h.Footer,{children:[e.jsx(w,{variant:"secondary",onClick:g,children:"Cancel"}),e.jsx(w,{variant:"primary",type:"submit",disabled:C,children:C?"Saving...":c?"Update":"Save"})]})]})})}function ae({show:_,handleClose:g,group:i=null,users:f=[],departments:p=[],gradingSystems:j=[]}){const c=!!i,{data:s,setData:r,processing:C,reset:v,errors:y}=A({name:"",code:"",description:"",department_id:"",coordinator_id:"",grading_system_id:"",display_order:0,is_active:!0}),{showErrorToast:u}=E(),n=()=>{const a=Date.now().toString(36).toUpperCase(),S=Math.random().toString(36).substring(2,6).toUpperCase();return`SG-${a}-${S}`};m.useEffect(()=>{c&&i?r({name:i.name||"",code:i.code||"",description:i.description||"",department_id:i.department_id||"",coordinator_id:i.coordinator_id||"",grading_system_id:i.grading_system_id||"",display_order:i.display_order??0,is_active:i.is_active??!0}):(v(),r("code",n()))},[i,c]);const d=async a=>{a.preventDefault();const S=c?"Update":"Create";try{if(!(await b.fire({title:`${S} Subject Group`,text:`Confirm to ${S.toLowerCase()} this subject group.`,icon:"question",showCancelButton:!0,confirmButtonText:"Yes",cancelButtonText:"Cancel",reverseButtons:!0})).isConfirmed)return;b.fire({title:"Please wait...",text:`${S} in progress`,icon:"info",allowOutsideClick:!1,allowEscapeKey:!1,didOpen:()=>b.showLoading()});const N=c?route("admin.subject-group.update",i.id):route("admin.subject-group.store"),G=c?await B.put(N,s):await B.post(N,s);G.data.success&&(k.success(G.data.message||`Subject group ${S.toLowerCase()}d successfully!`),v(),g())}catch(t){u(t)}finally{b.close()}};return e.jsx(h,{show:_,onHide:g,size:"lg",centered:!0,children:e.jsxs(o,{onSubmit:d,children:[e.jsx(h.Header,{closeButton:!0,children:e.jsx(h.Title,{children:c?"Edit Subject Group":"Create New Subject Group"})}),e.jsxs(h.Body,{children:[e.jsxs(x,{className:"mb-3",children:[e.jsx(l,{md:6,children:e.jsxs(T,{children:[e.jsx(T.Text,{children:e.jsx(P,{})}),e.jsx(o.Control,{type:"text",value:s.name,onChange:a=>r("name",a.target.value.trimStart()),isInvalid:!!y.name,placeholder:"Group Name",required:!0,maxLength:100}),e.jsx(o.Control.Feedback,{type:"invalid",children:y.name})]})}),e.jsx(l,{md:6,children:e.jsxs(T,{children:[e.jsx(T.Text,{children:e.jsx(Y,{})}),e.jsx(o.Control,{type:"text",value:s.code,onChange:a=>r("code",a.target.value.trim().toUpperCase()),isInvalid:!!y.code,placeholder:"Group Code",required:!0,maxLength:30}),e.jsx(o.Control.Feedback,{type:"invalid",children:y.code})]})})]}),e.jsx(o.Group,{className:"mb-3",children:e.jsx(o.Control,{as:"textarea",rows:2,placeholder:"Description",value:s.description,onChange:a=>r("description",a.target.value),maxLength:255})}),e.jsxs(x,{className:"mb-3",children:[e.jsx(l,{md:6,children:e.jsx(D,{options:p.map(a=>({value:a.id,label:a.name})),value:p.find(a=>a.id==s.department_id)?{value:s.department_id,label:p.find(a=>a.id==s.department_id).name}:null,onChange:a=>r("department_id",(a==null?void 0:a.value)||""),placeholder:"Select Department"})}),e.jsx(l,{md:6,children:e.jsx(D,{options:f.map(a=>({value:a.id,label:a.full_name})),value:f.find(a=>a.id==s.coordinator_id)?{value:s.coordinator_id,label:f.find(a=>a.id==s.coordinator_id).full_name}:null,onChange:a=>r("coordinator_id",(a==null?void 0:a.value)||""),placeholder:"Select Coordinator"})})]}),e.jsxs(x,{className:"mb-3",children:[e.jsx(l,{md:6,children:e.jsx(D,{options:j.map(a=>({value:a.id,label:a.name})),value:j.find(a=>a.id==s.grading_system_id)?{value:s.grading_system_id,label:j.find(a=>a.id==s.grading_system_id).name}:null,onChange:a=>r("grading_system_id",(a==null?void 0:a.value)||""),placeholder:"Select Grading System"})}),e.jsx(l,{md:6,children:e.jsx(o.Control,{type:"number",min:0,max:999,step:1,value:s.display_order,onChange:a=>r("display_order",a.target.value===""?0:parseInt(a.target.value,10)),placeholder:"Display Order"})})]}),e.jsx(o.Check,{type:"switch",id:"group-active",label:"Active",checked:s.is_active,onChange:a=>r("is_active",a.target.checked)})]}),e.jsxs(h.Footer,{children:[e.jsx(w,{variant:"secondary",onClick:g,disabled:C,children:"Cancel"}),e.jsx(w,{type:"submit",variant:"primary",disabled:C,children:C?c?"Updating...":"Creating...":c?"Update Group":"Create Group"})]})]})})}function se({show:_,onHide:g,subjectGroups:i=[],gradingSystems:f=[]}){const[p,j]=m.useState(!1),[c,s]=m.useState(null),{showErrorToast:r}=E();m.useEffect(()=>{if(!_)return;const n="#subjectGroupsTable",d=setTimeout(()=>{$.fn.DataTable.isDataTable(n)&&$(n).DataTable().clear().destroy(),$(n).DataTable({responsive:!0,pageLength:5,lengthMenu:[5,10,25,50],order:[[0,"asc"]],autoWidth:!1,columnDefs:[{orderable:!1,targets:[4]},{width:"20%",targets:4}]})},50);return()=>clearTimeout(d)},[_,i]);const C=m.useCallback(()=>{s(null),j(!0)},[]),v=m.useCallback(n=>{s(n),j(!0)},[]),y=m.useCallback(async n=>{try{if(!(await b.fire({title:"Delete Subject Group?",text:"Are you sure you want to delete this subject group?",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel",reverseButtons:!0})).isConfirmed)return;b.fire({title:"Deleting...",text:"Please wait",allowOutsideClick:!1,showConfirmButton:!1,didOpen:()=>b.showLoading()}),(await B.delete(route("admin.subject-group.destroy",n))).status===200&&(k.success("Subject group deleted successfully!"),q.reload())}catch(d){r(d)}finally{b.close()}},[]),u=m.useCallback(()=>{j(!1),Inertia.reload({only:["subjectGroups"]})},[]);return e.jsxs(e.Fragment,{children:[e.jsxs(h,{show:_,onHide:g,size:"lg",centered:!0,children:[e.jsx(h.Header,{closeButton:!0,children:e.jsxs(h.Title,{children:[e.jsx(P,{className:"me-1"}),"Subject Groups"]})}),e.jsxs(h.Body,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsxs("h5",{className:"m-0",children:["Total Groups: ",i.length]}),e.jsxs(w,{variant:"outline-primary",size:"sm",onClick:C,children:[e.jsx(R,{className:"me-1"}),"New Group"]})]}),e.jsxs(O,{striped:!0,bordered:!0,hover:!0,responsive:!0,className:"mb-0",id:"subjectGroupsTable",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Code"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Action"})]})}),e.jsx("tbody",{children:i.map((n,d)=>e.jsxs("tr",{children:[e.jsx("td",{children:d+1}),e.jsx("td",{children:n.code}),e.jsx("td",{children:n.name}),e.jsx("td",{children:Z(n.is_active)}),e.jsx("td",{children:e.jsxs(I,{className:"gap-2",children:[e.jsxs(w,{variant:"outline-primary",size:"sm",onClick:()=>v(n),children:[e.jsx(Q,{className:"me-1"}),"Edit"]}),e.jsxs(w,{variant:"outline-danger",size:"sm",onClick:()=>y(n.id),children:[e.jsx(V,{className:"me-1"}),"Delete"]})]})})]},n.id))})]})]})]}),e.jsx(ae,{show:p,handleClose:u,group:c,gradingSystems:f})]})}function we({subjectGroups:_=[],gradingSystems:g=[]}){const{auth:i}=H().props,[f,p]=m.useState(!1),[j,c]=m.useState(!1),[s,r]=m.useState(null),C=m.useCallback(()=>{$.fn.DataTable.isDataTable("#subjectsTable")&&$("#subjectsTable").DataTable().destroy(),$("#subjectsTable").DataTable({processing:!0,serverSide:!0,ajax:{url:route("admin.subject.index"),type:"GET"},columns:[{data:"code",title:"Code"},{data:"name",title:"Name"},{data:"subject_group.name",title:"Group"},{data:"department.name",title:"Department",render:function(u,n,d,a){return u||"N/A"}},{data:"grading_system.name",title:"Grading",render:function(u,n,d,a){return u||"N/A"}},{data:"status",title:"Status"},{data:"action",title:"Actions",className:"text-end"}],order:[[0,"asc"]],responsive:!0,autoWidth:!1})},[]),v=m.useCallback(async u=>{var n,d;try{if(!(await b.fire({title:"Delete Subject?",text:"Are you sure you want to delete this subject?",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel",reverseButtons:!0})).isConfirmed)return;(await B.delete(route("admin.subject.destroy",u))).status===200&&($("#subjectsTable").DataTable().ajax.reload(null,!1),k.success("Subject deleted successfully!"))}catch(a){k.error(((d=(n=a==null?void 0:a.response)==null?void 0:n.data)==null?void 0:d.message)||"An error occurred. Please try again.")}},[]);m.useEffect(()=>{C();const u=d=>{const a=$(d.currentTarget).data("data");if(!a)return k.error("Subject data not found.");r(a),p(!0)},n=d=>{const a=$(d.currentTarget).data("id");if(!a)return k.error("Subject ID not found.");v(a)};return $(document).on("click",".edit-btn",u),$(document).on("click",".delete-btn",n),()=>{$.fn.DataTable.isDataTable("#subjectsTable")&&$("#subjectsTable").DataTable().destroy(),$(document).off("click",".edit-btn",u),$(document).off("click",".delete-btn",n)}},[C,v]);const y=m.useCallback(()=>{p(!1),c(!1),r(null),$("#subjectsTable").DataTable().ajax.reload(null,!1)},[]);return e.jsxs(X,{user:i.user,children:[e.jsx(U,{title:"Subjects Management"}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h1",{className:"h3 mb-0",children:"Subjects Management"}),e.jsxs(I,{children:[e.jsxs(w,{variant:"outline-primary",onClick:()=>c(!0),className:"rounded me-2",children:[e.jsx(K,{className:"me-1"})," Subject Groups"]}),e.jsxs(w,{variant:"outline-primary",onClick:()=>{r(null),p(!0)},className:"rounded",children:[e.jsx(J,{className:"me-1"})," New Subject"]})]})]}),e.jsx("hr",{className:"dashed-hr"}),e.jsx(x,{children:e.jsx(l,{children:e.jsx(ee.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:e.jsx(F,{children:e.jsx(F.Body,{children:e.jsx(O,{id:"subjectsTable",className:"w-100 table-striped table-bordered",responsive:!0})})})})})}),e.jsx(se,{subjectGroups:_,gradingSystems:g,show:j,onHide:y}),e.jsx(te,{subjectGroups:_,gradingSystems:g,show:f,onHide:y,subject:s})]})}export{we as default};
