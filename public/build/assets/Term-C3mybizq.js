import{S as k,r as c,j as e,q as B,a as E}from"./app-CiDaUcey.js";import{e as N}from"./index-NpM1gPvR.js";import{y,P as M}from"./PortalLayout-CxqdbcvG.js";import{S as T}from"./sweetalert2.esm.all-89IKscqO.js";import{x as C}from"./useData-CInDpAgI.js";import{S as q}from"./react-select.esm-Le_u87zZ.js";import{u as A}from"./useErrorToast-CTAe8NjK.js";import{M as h}from"./Modal-CviNt8xm.js";import{F as x}from"./Form-DY59OgGH.js";import{R as j}from"./Row-DoEZsrd7.js";import{C as m}from"./Col-H7LL1jeG.js";import{B as _}from"./warning-CDyBO85i.js";import{a as D}from"./helpers-CqFYgsdY.js";import{B as F}from"./ButtonGroup-Bf8VZ0Fe.js";import{m as L}from"./proxy-CjJB-Dek.js";import{C as S}from"./Card-O6qekqvm.js";import{T as P}from"./Table-CC8sxR3u.js";import"./CloseButton-uf0rwOsm.js";import"./ElementChildren-Ykn35dyp.js";import"./Badge-B8SxXTMH.js";function R({show:b,onHide:u,term:s=null,academicYears:d=[]}){const i=!!s,{data:r,setData:n,processing:f,reset:p}=k({name:"",academic_year_id:"",start_date:"",end_date:"",is_active:!0}),{showErrorToast:o}=A();c.useEffect(()=>{var t,a;i&&s?n({name:s.name||"",academic_year_id:s.academic_year_id||"",start_date:((t=s.start_date)==null?void 0:t.split("T")[0])||"",end_date:((a=s.end_date)==null?void 0:a.split("T")[0])||"",is_active:s.is_active??!0}):p()},[s,i,p,n]);const l=async t=>{t.preventDefault();const a=i?"Update":"Create";try{if(!(await T.fire({title:`${a} Term`,text:`Confirm to ${a.toLowerCase()} this Term.`,icon:"question",showCancelButton:!0,confirmButtonText:"Yes",cancelButtonText:"Cancel",reverseButtons:!0})).isConfirmed)return;T.fire({title:"Please wait...",text:`${a} in progress`,icon:"info",allowOutsideClick:!1,allowEscapeKey:!1,didOpen:()=>T.showLoading()});const v=i?route("admin.term.update",s.id):route("admin.term.store"),w=i?await C.put(v,r):await C.post(v,r);w.data.success&&(y.success(w.data.message),p(),u())}catch(g){o(g)}finally{T.close()}};return e.jsx(h,{show:b,onHide:u,size:"md",centered:!0,children:e.jsxs(x,{onSubmit:l,children:[e.jsx(h.Header,{closeButton:!0,children:e.jsx(h.Title,{children:i?"Edit Term":"Create Term"})}),e.jsxs(h.Body,{children:[e.jsx(j,{className:"mb-3",children:e.jsx(m,{children:e.jsx(x.Control,{placeholder:"Term Name (e.g. Term 1)",value:r.name,onChange:t=>n("name",t.target.value),required:!0})})}),e.jsx(j,{className:"mb-3",children:e.jsx(m,{children:e.jsx(q,{options:d.map(t=>({value:t.id,label:t.name})),value:d.find(t=>t.id===r.academic_year_id)?{value:r.academic_year_id,label:d.find(t=>t.id===r.academic_year_id).name}:null,onChange:t=>n("academic_year_id",(t==null?void 0:t.value)||""),placeholder:"Select Academic Year"})})}),e.jsxs(j,{className:"mb-3",children:[e.jsx(m,{children:e.jsx(x.Control,{type:"date",value:r.start_date,onChange:t=>n("start_date",t.target.value),required:!0})}),e.jsx(m,{children:e.jsx(x.Control,{type:"date",value:r.end_date,onChange:t=>n("end_date",t.target.value),required:!0})})]}),e.jsx(j,{children:e.jsx(m,{children:e.jsx(x.Check,{label:"Active",checked:r.is_active,onChange:t=>n("is_active",t.target.checked)})})})]}),e.jsxs(h.Footer,{children:[e.jsx(_,{variant:"secondary",onClick:u,children:"Cancel"}),e.jsx(_,{variant:"primary",type:"submit",disabled:f,children:f?i?"Updating...":"Saving...":i?"Update":"Save"})]})]})})}function ne({academicYears:b=[]}){const{auth:u}=B().props,[s,d]=c.useState(!1),[i,r]=c.useState(null),n=c.useCallback(()=>{$.fn.DataTable.isDataTable("#termsTable")&&$("#termsTable").DataTable().destroy(),$("#termsTable").DataTable({processing:!0,serverSide:!0,ajax:{url:route("admin.term.index"),type:"GET"},columns:[{data:"name",title:"Name"},{data:"academic_year",title:"Academic Year"},{data:"start_date",title:"Start Date",render:function(o,l,t,a){return D(o)}},{data:"end_date",title:"End Date",render:function(o,l,t,a){return D(o)}},{data:"status",title:"Status"},{data:"action",title:"Actions",className:"text-end"}],order:[[1,"asc"]],responsive:!0,autoWidth:!1})},[]),f=c.useCallback(async o=>{var l,t;try{if(!(await T.fire({title:"Delete Term?",text:"Are you sure?",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed)return;await C.delete(route("admin.terms.destroy",o)),$("#termsTable").DataTable().ajax.reload(null,!1),y.success("Term deleted successfully!")}catch(a){y.error(((t=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:t.message)||"Error deleting.")}},[]);c.useEffect(()=>{n();const o=t=>{const a=$(t.currentTarget).data("data");r(a),d(!0)},l=t=>{const a=$(t.currentTarget).data("id");f(a)};return $(document).on("click",".edit-btn",o),$(document).on("click",".delete-btn",l),()=>{$.fn.DataTable.isDataTable("#termsTable")&&$("#termsTable").DataTable().destroy(),$(document).off("click",".edit-btn",o),$(document).off("click",".delete-btn",l)}},[n,f]);const p=c.useCallback(()=>{d(!1),r(null),$("#termsTable").DataTable().ajax.reload(null,!1)},[]);return e.jsxs(M,{user:u.user,children:[e.jsx(E,{title:"Terms"}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h1",{className:"h3 mb-0",children:"Terms"}),e.jsx(F,{children:e.jsxs(_,{variant:"outline-primary",onClick:()=>{r(null),d(!0)},children:[e.jsx(N,{className:"me-1"})," New Term"]})})]}),e.jsx("hr",{className:"dashed-hr"}),e.jsx(j,{children:e.jsx(m,{children:e.jsx(L.div,{initial:{opacity:0},animate:{opacity:1},children:e.jsx(S,{children:e.jsx(S.Body,{children:e.jsx(P,{id:"termsTable",className:"w-100 table-striped table-bordered",responsive:!0})})})})})}),e.jsx(R,{academicYears:b,show:s,onHide:p,term:i})]})}export{ne as default};
