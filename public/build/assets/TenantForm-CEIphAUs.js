import{r as i,S as W,j as a,a as O,J as A,f as I}from"./app-bV1oKjKy.js";import{P as z,y as G}from"./PortalLayout-u-5QNYDI.js";import{e as J,f as K,g as Y,h as H,i as Q,j as X}from"./index-CaxveVre.js";import{x as M}from"./useData-Bpd0XriX.js";import{S as P}from"./sweetalert2.esm.all-89IKscqO.js";import{S as q}from"./react-select.esm-BkhK0xLv.js";import{B as Z}from"./ButtonGroup-eq7KuXkt.js";import{C as F}from"./Card-ClEnLKUp.js";import{F as r}from"./Form-CnKhehiI.js";import{R as V}from"./Row-B4t5VXUr.js";import{C as p}from"./Col-CcX1xzGs.js";import{I as f}from"./InputGroup-C1XhqFRU.js";import{B as U}from"./warning-DViRBwvh.js";import"./CloseButton-BYbBlkTD.js";import"./ElementChildren-C0T05OxF.js";function ee(t={}){const[S,y]=i.useState([]),[L,C]=i.useState([]),[u,g]=i.useState([]),[E,j]=i.useState([]),[T,d]=i.useState(!0),[B,w]=i.useState(null),[s,_]=i.useState({county_id:t.county_id??"",constituency_id:t.constituency_id??"",ward_id:t.ward_id??"",location_id:t.location_id??""}),h={counties:route("api.counties"),constituencies:n=>route("api.constituencies",n),wards:n=>route("api.wards",n),locations:n=>route("api.locations",n)},o=i.useCallback(async(n,m,N=null)=>{try{const c=typeof n=="function"?n(N):n,R=await fetch(c);if(!R.ok)throw new Error(`Request failed (${R.status})`);const D=await R.json();return m(D),D}catch(c){throw w(c.message||"Failed to fetch location data"),c}},[]),v=i.useCallback(()=>o(h.counties,y),[o]),e=i.useCallback(n=>n?o(h.constituencies,C,n):C([]),[o]),l=i.useCallback(n=>n?o(h.wards,g,n):g([]),[o]),x=i.useCallback(n=>n?o(h.locations,j,n):j([]),[o]),b=i.useCallback((n,m)=>{_(N=>{const c={...N,[n]:m};return n==="county_id"&&(c.constituency_id="",c.ward_id="",c.location_id=""),n==="constituency_id"&&(c.ward_id="",c.location_id=""),n==="ward_id"&&(c.location_id=""),c})},[]);return i.useEffect(()=>{(async()=>{d(!0),w(null);try{await v(),t.county_id&&await e(t.county_id),t.constituency_id&&await l(t.constituency_id),t.ward_id&&await x(t.ward_id)}catch{}finally{d(!1)}})()},[]),i.useEffect(()=>{e(s.county_id),g([]),j([])},[s.county_id]),i.useEffect(()=>{l(s.constituency_id),j([])},[s.constituency_id]),i.useEffect(()=>{x(s.ward_id)},[s.ward_id]),{selected:s,setSelected:_,isLoading:T,error:B,counties:S,constituencies:L,wards:u,locations:E,handleChange:b,refreshCounties:v,refreshConstituencies:e,refreshWards:l,refreshLocations:x,refreshAll:async()=>{d(!0),w(null);try{await v(),s.county_id&&await e(s.county_id),s.constituency_id&&await l(s.constituency_id),s.ward_id&&await x(s.ward_id)}finally{d(!1)}}}}function je({school:t=null,plans:S=[]}){const y=i.useRef(),[L,C]=i.useState(!1),u=!!t,{handleChange:g,counties:E,constituencies:j,wards:T}=ee(u?{county_id:t==null?void 0:t.county_id,constituency_id:t==null?void 0:t.constituency_id,ward_id:t==null?void 0:t.ward_id}:{}),{data:d,setData:B,reset:w}=W({name:(t==null?void 0:t.name)||"",domain:(t==null?void 0:t.domain)||"",email:(t==null?void 0:t.email)||"",phone:(t==null?void 0:t.phone)||"",address:(t==null?void 0:t.address)||"",plan_id:(t==null?void 0:t.plan_id)||1,county_id:(t==null?void 0:t.county_id)||"",constituency_id:(t==null?void 0:t.constituency_id)||"",ward_id:(t==null?void 0:t.ward_id)||""}),s=e=>{const{name:l,value:x}=e.target;B(l,x)},_=(e,l)=>{g(e,l),B(e,l)};i.useEffect(()=>{y.current&&($(y.current).validate({rules:{name:{required:!0,minlength:3,maxlength:255},domain:{required:!0,minlength:3,maxlength:50,regex:/^[a-z0-9-.]+$/i},email:{required:!0,email:!0,maxlength:255},phone:{required:!0,minlength:10,maxlength:15},address:{required:!0,minlength:5,maxlength:500},plan_id:{required:!0},county_id:{required:!0},constituency_id:{required:!0},ward_id:{required:!0}},messages:{domain:{regex:"Domain can only contain letters, numbers and hyphens"}},errorClass:"is-invalid",validClass:"is-valid",errorPlacement:function(e,l){e.addClass("invalid-feedback"),l.closest(".form-group").append(e)}}),$.validator.addMethod("regex",function(e,l,x){const b=new RegExp(x);return this.optional(l)||b.test(e)},"Please check your input."))},[]);const h=async e=>{var x,b,k,n;if(e.preventDefault(),!(!$(y.current).valid()||!(await P.fire({title:u?"Update school?":"Create school?",text:u?"Are you sure you want to update this school?":"Are you sure you want to create this school?",icon:"question",showCancelButton:!0,confirmButtonText:u?"Yes, Update":"Yes, Create"})).isConfirmed)){C(!0),P.fire({title:u?"Updating...":"Creating...",text:"Please wait",allowOutsideClick:!1,showConfirmButton:!1,didOpen:()=>P.showLoading()});try{let m;u?m=await M.put(route("admin.tenant.update",t==null?void 0:t.id),d):m=await M.post(route("admin.tenant.store"),d),m.data.success===!0?(G.success(m.data.message),I.visit(route("admin.tenant.index"))):G.error(m.data.message)}catch(m){(b=(x=m.response)==null?void 0:x.data)!=null&&b.errors?Object.values(m.response.data.errors).forEach(N=>{N.forEach(c=>G.error(c))}):G.error((n=(k=m.response)==null?void 0:k.data)==null?void 0:n.message)}finally{C(!1),P.close()}}},o=u?`Edit ${t==null?void 0:t.name}`:"Create New Tenant",v=L?u?"Updating...":"Creating...":u?"Update Tenant":"Create Tenant";return a.jsxs(z,{children:[a.jsx(O,{title:o}),a.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[a.jsx("h2",{className:"m-0 text-capitalize",children:o}),a.jsx(Z,{children:a.jsxs(A,{href:route("admin.tenant.index"),className:"btn btn-outline-primary",children:[a.jsx(J,{className:"me-2"}),"Back to Tenants"]})})]}),a.jsx("hr",{className:"dashed-hr"}),a.jsx(F,{children:a.jsx(F.Body,{children:a.jsxs(r,{ref:y,onSubmit:h,children:[a.jsx(F.Body,{children:a.jsxs(V,{className:"g-3",children:[a.jsx(p,{md:6,children:a.jsxs(r.Group,{children:[a.jsx(r.Label,{className:"d-flex align-items-center",children:"Tenant Name"}),a.jsxs(f,{className:"border rounded",children:[a.jsx(f.Text,{className:"border-0",children:a.jsx(K,{})}),a.jsx(r.Control,{name:"name",type:"text",value:d.name,onChange:s,placeholder:"Enter tenant name",className:"border-0"})]})]})}),a.jsx(p,{md:6,children:a.jsxs(r.Group,{children:[a.jsx(r.Label,{className:"d-flex align-items-center",children:"Domain"}),a.jsxs(f,{className:"border rounded",children:[a.jsx(f.Text,{className:"border-0",children:a.jsx(Y,{})}),u&&(t!=null&&t.domains)?t==null?void 0:t.domains.map((e,l)=>a.jsx(r.Control,{name:"domain",type:"text",value:e.domain,onChange:s,placeholder:"your-tenant",readOnly:l>0,className:"border-0"},l)):a.jsx(r.Control,{name:"domain",type:"text",value:d.domain,onChange:s,placeholder:"your-tenant",className:"border-0"})]})]})}),a.jsx(p,{md:6,children:a.jsxs(r.Group,{children:[a.jsx(r.Label,{className:"d-flex align-items-center",children:"Phone"}),a.jsxs(f,{className:"border rounded",children:[a.jsx(f.Text,{className:"border-0",children:a.jsx(H,{})}),a.jsx(r.Control,{name:"phone",type:"tel",value:d.phone,onChange:s,placeholder:"+254 700 000000",className:"border-0"})]})]})}),a.jsx(p,{md:6,children:a.jsxs(r.Group,{children:[a.jsx(r.Label,{className:"d-flex align-items-center",children:"Email"}),a.jsxs(f,{className:"border rounded",children:[a.jsx(f.Text,{className:"border-0",children:a.jsx(Q,{})}),a.jsx(r.Control,{name:"email",type:"email",value:d.email,onChange:s,placeholder:"tenant@example.com",className:"border-0"})]})]})}),a.jsx(p,{md:12,children:a.jsxs(r.Group,{children:[a.jsx(r.Label,{className:"d-flex align-items-center",children:"Address"}),a.jsxs(f,{className:"border rounded",children:[a.jsx(f.Text,{className:"border-0",children:a.jsx(X,{})}),a.jsx(r.Control,{as:"textarea",name:"address",rows:1,value:d.address,onChange:s,placeholder:"Physical address of the tenant",className:"border-0"})]})]})}),a.jsx(p,{md:3,children:a.jsxs(r.Group,{children:[a.jsx(r.Label,{children:"Plan"}),a.jsx(q,{name:"plan_id",value:S.map(e=>({value:e.id,label:`${e.name} - Ksh ${e.price} / ${e.period}`})).find(e=>e.value===d.plan_id)||null,onChange:e=>s({target:{name:"plan_id",value:e==null?void 0:e.value}}),options:S.map(e=>({value:e.id,label:`${e.name} - Ksh ${e.price} / ${e.period}`})),placeholder:"-- Select Plan --"})]})}),a.jsx(p,{md:3,children:a.jsxs(r.Group,{children:[a.jsx(r.Label,{children:"County"}),a.jsx(q,{name:"county_id",value:E.map(e=>({value:e.id,label:e.name})).find(e=>e.value===d.county_id)||null,onChange:e=>_("county_id",e==null?void 0:e.value),options:E.map(e=>({value:e.id,label:e.name})),placeholder:"-- Select County --"})]})}),a.jsx(p,{md:3,children:a.jsxs(r.Group,{children:[a.jsx(r.Label,{children:"Constituency"}),a.jsx(q,{name:"constituency_id",value:j.map(e=>({value:e.id,label:e.name})).find(e=>e.value===d.constituency_id)||null,onChange:e=>_("constituency_id",e==null?void 0:e.value),options:j.map(e=>({value:e.id,label:e.name})),placeholder:"-- Select Constituency --",isDisabled:!d.county_id})]})}),a.jsx(p,{md:3,children:a.jsxs(r.Group,{children:[a.jsx(r.Label,{children:"Ward"}),a.jsx(q,{name:"ward_id",value:T.map(e=>({value:e.id,label:e.name})).find(e=>e.value===d.ward_id)||null,onChange:e=>_("ward_id",e==null?void 0:e.value),options:T.map(e=>({value:e.id,label:e.name})),placeholder:"-- Select Ward --",isDisabled:!d.constituency_id})]})})]})}),a.jsxs(F.Footer,{className:"d-flex justify-content-between bg-transparent border-0",children:[u?a.jsx(A,{href:route("admin.tenant.index"),className:"btn btn-outline-secondary",children:"Cancel"}):a.jsx(U,{type:"button",variant:"danger",onClick:w,children:"Reset"}),a.jsx(U,{type:"submit",variant:"primary",disabled:L,children:v})]})]})})})]})}export{je as default};
