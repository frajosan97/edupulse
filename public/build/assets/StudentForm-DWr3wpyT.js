import{r as u,j as e,a as ge,J as _e,d as ye,f as Ce}from"./app-bV1oKjKy.js";import{y as $,P as we}from"./PortalLayout-u-5QNYDI.js";import{q as Fe,a1 as Se,H as ae,$ as C,T as Be,P as Pe,W as ke,o as L,b as ce,a8 as Ie,a9 as Le,c as Te,U as Ge,aa as Ee,a4 as qe,a5 as Ae,a6 as $e}from"./index-6KH3gXbP.js";import{u as Re,S as Oe,c as re,d as Ue,a as x,e as De}from"./index.esm-BLArGU5R.js";import{S as k}from"./react-select.esm-BkhK0xLv.js";import{S as I}from"./sweetalert2.esm.all-89IKscqO.js";import{u as Me}from"./useErrorToast-B9XNEQ0p.js";import{B as le}from"./Badge-DAm-MJP0.js";import{C as ne,B as _}from"./warning-DViRBwvh.js";import{B as Ve}from"./ButtonGroup-eq7KuXkt.js";import{F as l}from"./Form-CnKhehiI.js";import{T as y}from"./Tab-DV6BPVb7.js";import{C as m}from"./Card-ClEnLKUp.js";import{N as R}from"./useData-Bpd0XriX.js";import{R as b}from"./Row-B4t5VXUr.js";import{C as i}from"./Col-CcX1xzGs.js";import{I as ze}from"./Image-CwO22QY5.js";import"./CloseButton-BYbBlkTD.js";import"./ElementChildren-C0T05OxF.js";const o=[{key:"student",label:"Student Details",icon:e.jsx(C,{}),color:"#4f46e5"},{key:"parents",label:"Parents/Guardians",icon:e.jsx(ce,{}),color:"#7c3aed"},{key:"academic",label:"Academic Info",icon:e.jsx(L,{}),color:"#0ea5e9"}],ie={first_name:"",last_name:"",other_name:"",admission_number:"",date_of_birth:"",gender:"",profile_image:null,is_active:!0,class_id:null,stream_id:null,parents:[{name:"",email:"",phone:"",relationship:"parent"}]},Xe=re({first_name:x().required("First name is required").min(2,"Minimum 2 characters"),last_name:x().required("Last name is required").min(2,"Minimum 2 characters"),admission_number:x().required("Admission number is required").min(3,"Minimum 3 characters"),date_of_birth:De().nullable().max(new Date,"Date of birth cannot be in the future"),gender:x().oneOf(["male","female","other"],"Invalid gender selection"),class_id:x().required("Class is required"),parents:Ue().of(re().shape({name:x().required("Parent name is required"),email:x().email("Invalid email address").nullable(),phone:x().required("Phone number is required"),relationship:x().required("Relationship is required")}))}),te=[{value:"parent",label:"Parent"},{value:"guardian",label:"Guardian"},{value:"sibling",label:"Sibling"},{value:"other",label:"Other"}],de=[{value:"male",label:"Male"},{value:"female",label:"Female"},{value:"other",label:"Other"}];function us({classes:w=[],student:d=null}){var M,V,z,X;const{showErrorToast:me}=Me(),p=!!d,[c,T]=u.useState("student"),[G,Ke]=u.useState(!1),[E,oe]=u.useState((d==null?void 0:d.profile_image_url)||null),[f,O]=u.useState([]),he=a=>{var r,t;return((t=(r=a==null?void 0:a.student)==null?void 0:r.parents)==null?void 0:t.length)>0?a.student.parents.map(n=>({name:n.full_name||"",email:n.email||"",phone:n.phone||"",relationship:n.relationship||"parent"})):[{name:"",email:"",phone:"",relationship:"parent"}]},s=Re({initialValues:p?{...ie,first_name:d.first_name||"",last_name:d.last_name||"",other_name:d.other_name||"",admission_number:((M=d.student)==null?void 0:M.admission_number)||"",date_of_birth:d.date_of_birth||"",gender:d.gender||"",is_active:d.is_active??!0,class_id:((V=d.student)==null?void 0:V.class_id)||null,stream_id:((z=d.student)==null?void 0:z.class_stream_id)||null,parents:he(d)}:ie,validationSchema:Xe,enableReinitialize:!0,context:{hasStreams:f.length>0},onSubmit:async a=>{const r=p?"Update":"Register";try{if(!(await I.fire({title:`${r} Student`,text:`Confirm to ${r.toLowerCase()} this student.`,icon:"question",showCancelButton:!0,confirmButtonText:"Yes",cancelButtonText:"Cancel",reverseButtons:!0})).isConfirmed)return;I.fire({title:"Please wait...",text:`${r} in progress`,icon:"info",allowOutsideClick:!1,allowEscapeKey:!1,didOpen:()=>I.showLoading()});const n=new FormData;for(const j in a)j==="parents"?a.parents.forEach((N,P)=>{Object.keys(N).forEach(g=>{n.append(`parents[${P}][${g}]`,N[g])})}):a[j]!==null&&a[j]!==void 0&&n.append(j,a[j]);const S=p?route("admin.student.update",d.id):route("admin.student.store"),B="post";p&&n.append("_method","PUT");const A=await ye[B](S,n,{headers:{"Content-Type":"multipart/form-data"}});$.success(p?"Student updated successfully!":"Student registered successfully!"),Ce.visit(route("admin.student.index"))}catch(t){me(t)}finally{I.close()}}}),U=u.useMemo(()=>w.map(a=>({value:a.id,label:a.name})),[w]),q=u.useMemo(()=>f.map(a=>{var r;return{value:a.id,label:((r=a.stream)==null?void 0:r.name)||a.name}}),[f]),v=u.useMemo(()=>w.find(a=>a.id==s.values.class_id),[w,s.values.class_id]);u.useEffect(()=>{if(!v){O([]),s.setFieldValue("stream_id",null);return}const a=v.class_streams||[];O(a),s.values.stream_id&&!a.some(r=>r.id==s.values.stream_id)&&s.setFieldValue("stream_id",null)},[v,s.values.stream_id]);const ue=a=>{const r=a.currentTarget.files[0];r&&(s.setFieldValue("profile_image",r),oe(URL.createObjectURL(r)))},F=(a,r,t)=>{const n=[...s.values.parents];n[a][r]=t,s.setFieldValue("parents",n)},pe=()=>{s.setFieldValue("parents",[...s.values.parents,{name:"",email:"",phone:"",relationship:"parent"}])},xe=a=>{if(s.values.parents.length<=1){$.warning("At least one parent is required");return}const r=[...s.values.parents];r.splice(a,1),s.setFieldValue("parents",r)},je=c===o[0].key,be=c===o[o.length-1].key,fe=u.useCallback(()=>{let a={};if(c==="student"?["first_name","last_name","admission_number","gender","class_id"].forEach(n=>{s.errors[n]&&(a[n]=s.errors[n])}):c==="parents"&&s.values.parents.forEach((t,n)=>{t.name||(a[`parents.${n}.name`]="Required"),t.phone||(a[`parents.${n}.phone`]="Required")}),Object.keys(a).length>0){s.setErrors(a),$.error("Please note that all fields marked with * are required!");return}const r=o.findIndex(t=>t.key===c);r<o.length-1&&T(o[r+1].key)},[c,s]),ve=u.useCallback(()=>{const a=o.findIndex(r=>r.key===c);a>0&&T(o[a-1].key)},[c]),Ne=u.useCallback(()=>s.values.is_active?e.jsxs(le,{bg:"success",className:"fs-6 px-3 py-2",children:[e.jsx(Fe,{className:"me-1"}),"Active"]}):e.jsx(le,{bg:"secondary",className:"fs-6 px-3 py-2",children:"Inactive"}),[s.values.is_active]);o.find(a=>a.key===c);const D=p?`Edit ${d.first_name} ${d.last_name}`:"Register New Student";return e.jsxs(we,{children:[e.jsx(ge,{title:D}),e.jsxs(ne,{fluid:!0,className:"mb-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h2",{className:"m-0 text-capitalize",children:D}),e.jsx(Ve,{children:e.jsxs(_e,{href:route("admin.student.index"),className:"btn btn-outline-primary",children:[e.jsx(Se,{className:"me-2"}),"Back to Students"]})})]}),e.jsx("hr",{className:"dashed-hr mt-2"})]}),e.jsx(ne,{fluid:!0,children:e.jsx(l,{onSubmit:s.handleSubmit,encType:"multipart/form-data",children:e.jsx(y.Container,{activeKey:c,onSelect:T,children:e.jsxs(m,{className:"shadow-sm border-0 mb-4",children:[e.jsx(m.Header,{className:"bg-white border-0 pb-0",children:e.jsx(R,{variant:"tabs",className:"border-0",children:o.map(({key:a,label:r,icon:t,color:n})=>e.jsx(R.Item,{children:e.jsx(R.Link,{eventKey:a,className:`px-4 py-3 rounded-0 border-0 ${c===a?"border-bottom-3":""}`,style:{color:c===a?n:"#6b7280",fontWeight:c===a?"600":"400",borderBottom:c===a?`3px solid ${n}`:"3px solid transparent",backgroundColor:"transparent"},children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"me-2",style:{color:c===a?n:"#9ca3af"},children:t}),e.jsx("span",{children:r})]})})},a))})}),e.jsx(m.Body,{children:e.jsxs(y.Content,{children:[e.jsx(y.Pane,{eventKey:"student",children:e.jsxs(b,{className:"g-4",children:[e.jsx(i,{md:4,lg:3,children:e.jsx(m,{className:"border-0 bg-light",children:e.jsxs(m.Body,{className:"text-center p-4",children:[e.jsx("div",{className:"mb-3",children:E?e.jsx(ze,{src:E,roundedCircle:!0,fluid:!0,className:"border shadow-sm",style:{width:120,height:120,objectFit:"cover"}}):e.jsx("div",{className:"border rounded-circle d-flex justify-content-center align-items-center bg-white mx-auto",style:{width:120,height:120},children:e.jsx(ae,{size:50,className:"text-muted"})})}),e.jsxs(l.Group,{children:[e.jsxs(l.Label,{className:"btn btn-outline-primary btn-sm w-100 cursor-pointer mb-0",htmlFor:"profile_image",children:[e.jsx(ae,{className:"me-2"}),E?"Change Photo":"Upload Photo"]}),e.jsx(l.Control,{type:"file",id:"profile_image",name:"profile_image",accept:"image/*",onChange:ue,className:"d-none"})]}),e.jsx("div",{className:"small text-muted mt-2",children:"JPG, PNG or GIF. Max 2MB."})]})})}),e.jsx(i,{md:8,lg:9,children:e.jsxs(b,{className:"g-3",children:[e.jsx(i,{md:4,children:e.jsxs(l.Group,{children:[e.jsxs(l.Label,{className:"fw-semibold",children:[e.jsx(C,{className:"me-2"}),"First Name *"]}),e.jsx(l.Control,{name:"first_name",value:s.values.first_name,onChange:s.handleChange,onBlur:s.handleBlur,isInvalid:s.touched.first_name&&!!s.errors.first_name,placeholder:"Enter first name",className:"py-2"}),e.jsx(l.Control.Feedback,{type:"invalid",children:s.errors.first_name})]})}),e.jsx(i,{md:4,children:e.jsxs(l.Group,{children:[e.jsxs(l.Label,{className:"fw-semibold",children:[e.jsx(C,{className:"me-2"}),"Last Name *"]}),e.jsx(l.Control,{name:"last_name",value:s.values.last_name,onChange:s.handleChange,onBlur:s.handleBlur,isInvalid:s.touched.last_name&&!!s.errors.last_name,placeholder:"Enter last name",className:"py-2"}),e.jsx(l.Control.Feedback,{type:"invalid",children:s.errors.last_name})]})}),e.jsx(i,{md:4,children:e.jsxs(l.Group,{children:[e.jsxs(l.Label,{className:"fw-semibold",children:[e.jsx(C,{className:"me-2"}),"Other Name"]}),e.jsx(l.Control,{name:"other_name",value:s.values.other_name,onChange:s.handleChange,onBlur:s.handleBlur,placeholder:"Enter other name",className:"py-2"})]})}),e.jsx(i,{md:4,children:e.jsxs(l.Group,{children:[e.jsxs(l.Label,{className:"fw-semibold",children:[e.jsx(Be,{className:"me-2"}),"Admission No. *"]}),e.jsx(l.Control,{name:"admission_number",value:s.values.admission_number,onChange:s.handleChange,onBlur:s.handleBlur,isInvalid:s.touched.admission_number&&!!s.errors.admission_number,placeholder:"e.g., ADM2023001",className:"py-2"}),e.jsx(l.Control.Feedback,{type:"invalid",children:s.errors.admission_number})]})}),e.jsx(i,{md:4,children:e.jsxs(l.Group,{children:[e.jsxs(l.Label,{className:"fw-semibold",children:[e.jsx(Pe,{className:"me-2"}),"Date of Birth"]}),e.jsx(l.Control,{type:"date",name:"date_of_birth",value:s.values.date_of_birth,onChange:s.handleChange,onBlur:s.handleBlur,className:"py-2"})]})}),e.jsx(i,{md:4,children:e.jsxs(l.Group,{children:[e.jsxs(l.Label,{className:"fw-semibold",children:[e.jsx(ke,{className:"me-2"}),"Gender"]}),e.jsx(k,{name:"gender",options:de,value:de.find(a=>a.value===s.values.gender),onChange:a=>s.setFieldValue("gender",(a==null?void 0:a.value)||""),onBlur:s.handleBlur,isInvalid:s.touched.gender&&!!s.errors.gender,placeholder:"Select gender",className:"react-select-container",classNamePrefix:"react-select"}),s.touched.gender&&s.errors.gender&&e.jsx("div",{className:"invalid-feedback d-block",children:s.errors.gender})]})}),e.jsx(i,{md:6,children:e.jsxs(l.Group,{children:[e.jsxs(l.Label,{className:"fw-semibold",children:[e.jsx(L,{className:"me-2"}),"Class *"]}),e.jsx(k,{name:"class_id",options:U,value:U.find(a=>a.value==s.values.class_id),onChange:a=>s.setFieldValue("class_id",(a==null?void 0:a.value)||null),onBlur:s.handleBlur,isInvalid:s.touched.class_id&&!!s.errors.class_id,placeholder:"Select class",className:"react-select-container",classNamePrefix:"react-select"}),s.touched.class_id&&s.errors.class_id&&e.jsx("div",{className:"invalid-feedback d-block",children:s.errors.class_id})]})}),e.jsx(i,{md:6,children:e.jsxs(l.Group,{children:[e.jsxs(l.Label,{className:"fw-semibold",children:[e.jsx(L,{className:"me-2"}),"Stream"," ",f.length>0&&"*"]}),e.jsx(k,{name:"stream_id",options:q,value:q.find(a=>a.value==s.values.stream_id),onChange:a=>s.setFieldValue("stream_id",(a==null?void 0:a.value)||null),onBlur:s.handleBlur,isInvalid:s.touched.stream_id&&!!s.errors.stream_id,placeholder:f.length>0?"Select stream":"No streams available",className:"react-select-container",classNamePrefix:"react-select",isDisabled:f.length===0}),s.touched.stream_id&&s.errors.stream_id&&e.jsx("div",{className:"invalid-feedback d-block",children:s.errors.stream_id})]})})]})})]})}),e.jsx(y.Pane,{eventKey:"parents",children:e.jsx(b,{className:"g-4",children:e.jsx(i,{lg:12,children:e.jsx(m,{className:"border-0 bg-light",children:e.jsxs(m.Body,{className:"p-4",children:[e.jsxs("h6",{className:"fw-bold mb-3 d-flex align-items-center",children:[e.jsx(ce,{className:"me-2"}),"Parent/Guardian Information"]}),s.values.parents.map((a,r)=>{var t,n,S,B,A,j,N,P,g,K,H,J,W,Y,Q,Z,ee,se;return e.jsxs("div",{className:"mb-4 p-3 border rounded bg-white",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("h6",{className:"mb-0",children:["Parent/Guardian #",r+1]}),r>0&&e.jsx(_,{variant:"outline-danger",size:"sm",onClick:()=>xe(r),children:"Remove"})]}),e.jsxs(b,{children:[e.jsx(i,{md:6,children:e.jsxs(l.Group,{children:[e.jsxs(l.Label,{className:"fw-semibold",children:[e.jsx(Ie,{className:"me-2"}),"Full Name *"]}),e.jsx(l.Control,{name:`parents.${r}.name`,value:a.name,onChange:h=>F(r,"name",h.target.value),onBlur:s.handleBlur,isInvalid:((n=(t=s.touched.parents)==null?void 0:t[r])==null?void 0:n.name)&&!!((B=(S=s.errors.parents)==null?void 0:S[r])!=null&&B.name),placeholder:"Parent's full name",className:"py-2"}),e.jsx(l.Control.Feedback,{type:"invalid",children:(j=(A=s.errors.parents)==null?void 0:A[r])==null?void 0:j.name})]})}),e.jsx(i,{md:6,children:e.jsxs(l.Group,{children:[e.jsxs(l.Label,{className:"fw-semibold",children:[e.jsx(Le,{className:"me-2"}),"Relationship"]}),e.jsx(k,{options:te,value:te.find(h=>h.value===a.relationship),onChange:h=>F(r,"relationship",(h==null?void 0:h.value)||"parent"),placeholder:"Select relationship",className:"react-select-container",classNamePrefix:"react-select"})]})})]}),e.jsxs(b,{className:"mt-3",children:[e.jsx(i,{md:6,children:e.jsxs(l.Group,{children:[e.jsxs(l.Label,{className:"fw-semibold",children:[e.jsx(Te,{className:"me-2"}),"Email"]}),e.jsx(l.Control,{type:"email",name:`parents.${r}.email`,value:a.email,onChange:h=>F(r,"email",h.target.value),onBlur:s.handleBlur,isInvalid:((P=(N=s.touched.parents)==null?void 0:N[r])==null?void 0:P.email)&&!!((K=(g=s.errors.parents)==null?void 0:g[r])!=null&&K.email),placeholder:"parent@example.com",className:"py-2"}),e.jsx(l.Control.Feedback,{type:"invalid",children:(J=(H=s.errors.parents)==null?void 0:H[r])==null?void 0:J.email})]})}),e.jsx(i,{md:6,children:e.jsxs(l.Group,{children:[e.jsxs(l.Label,{className:"fw-semibold",children:[e.jsx(Ge,{className:"me-2"}),"Phone *"]}),e.jsx(l.Control,{name:`parents.${r}.phone`,value:a.phone,onChange:h=>F(r,"phone",h.target.value),onBlur:s.handleBlur,isInvalid:((Y=(W=s.touched.parents)==null?void 0:W[r])==null?void 0:Y.phone)&&!!((Z=(Q=s.errors.parents)==null?void 0:Q[r])!=null&&Z.phone),placeholder:"+2547XXXXXXXX",className:"py-2"}),e.jsx(l.Control.Feedback,{type:"invalid",children:(se=(ee=s.errors.parents)==null?void 0:ee[r])==null?void 0:se.phone})]})})]})]},r)}),e.jsx("div",{className:"mb-4",children:e.jsxs(_,{variant:"outline-primary",onClick:pe,children:[e.jsx(Ee,{className:"me-1"}),"Add Another Parent/Guardian"]})})]})})})})}),e.jsx(y.Pane,{eventKey:"academic",children:e.jsxs(b,{className:"g-4",children:[e.jsxs(i,{lg:8,children:[e.jsx(m,{className:"border-0 bg-light",children:e.jsxs(m.Body,{className:"p-4",children:[e.jsx("h6",{className:"fw-bold mb-3",children:"Student Status"}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between p-3 bg-white rounded-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",children:"Account Status"}),e.jsx("small",{className:"text-muted",children:s.values.is_active?"This student is active and can access the system":"This student is inactive and cannot access the system"})]}),e.jsx(l.Check,{type:"switch",id:"is_active",name:"is_active",checked:s.values.is_active,onChange:s.handleChange,style:{transform:"scale(1.2)"}})]})]})}),e.jsx(m,{className:"border-0 bg-light mt-4",children:e.jsxs(m.Body,{className:"p-4",children:[e.jsxs("h6",{className:"fw-bold text-primary mb-3",children:[e.jsx(L,{className:"me-2"}),"Academic Summary"]}),e.jsxs(b,{children:[e.jsx(i,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"small text-muted mb-1",children:"Selected Class"}),e.jsx("div",{className:"fw-semibold",children:(v==null?void 0:v.name)||"Not selected"})]})}),e.jsx(i,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"small text-muted mb-1",children:"Stream"}),e.jsx("div",{className:"fw-semibold",children:((X=q.find(a=>a.value==s.values.stream_id))==null?void 0:X.label)||"Not selected"})]})})]})]})})]}),e.jsx(i,{lg:4,children:e.jsx(m,{className:"border-0 bg-primary bg-opacity-10",children:e.jsxs(m.Body,{className:"p-4",children:[e.jsxs("h6",{className:"fw-bold text-primary mb-3",children:[e.jsx(C,{className:"me-2"}),"Overview"]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"small text-muted mb-1",children:"Current Status"}),Ne()]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"small text-muted mb-1",children:"Number of Parents/Guardians"}),e.jsx("div",{className:"fw-semibold",children:s.values.parents.length})]}),e.jsx("p",{className:"small text-muted mb-0",children:"Active students can access the school portal. Inactive students are archived but their data is preserved."})]})})})]})})]})}),e.jsx(m.Footer,{className:"bg-light border-0 py-4",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs(_,{variant:"outline-secondary",onClick:ve,disabled:je||G,className:"px-4 py-2 d-flex align-items-center",children:[e.jsx(qe,{className:"me-2",size:18}),"Previous"]}),e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("span",{className:"text-muted me-3 small",children:["Step"," ",o.findIndex(a=>a.key===c)+1," ","of ",o.length]}),be?e.jsx(_,{variant:"primary",type:"submit",disabled:G,className:"px-4 py-2 d-flex align-items-center",children:G?e.jsxs(e.Fragment,{children:[e.jsx(Oe,{animation:"border",size:"sm",className:"me-2"}),p?"Updating...":"Registering..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ae,{className:"me-2",size:18}),p?"Update Student":"Register Student"]})}):e.jsxs(_,{variant:"primary",onClick:fe,className:"px-4 py-2 d-flex align-items-center",children:["Next",e.jsx($e,{className:"ms-2",size:18})]})]})]})})]})})})})]})}export{us as default};
